!function(){function t(t){e.r([r[t]])}var e={r:function(t){if(e[t].inited)return e[t].value;if("function"!=typeof e[t].value)return e[t].inited=!0,e[t].value;var r={exports:{}},i=e[t].value(null,r.exports,r);if(e[t].inited=!0,e[t].value=i,void 0!==i)return i;for(var n in r.exports)if(r.exports.hasOwnProperty(n))return e[t].inited=!0,e[t].value=r.exports,r.exports}};e[0]={value:function(){function t(i,n,o,s){return s=0|s,s>e?o:(s++,r.each(o,function(e,o){i?!e||"object"!=typeof e&&"function"!=typeof e?n[o]=e:(n[o]=n[o]||(r.isArray(e)?[]:{}),n[o]=t(i,n[o],e,s)):n[o]=e}),n)}var e=10,r={extend:function(e,i){var n=!1;if("boolean"==typeof e?(n=e,e=i,i=[].splice.call(arguments,2)):i=[].splice.call(arguments,1),!e)throw new Error("Utils: extend, target can not be empty");return r.each(i,function(r){(r&&"object"==typeof r||"function"==typeof r)&&t(n,e,r)}),e},contains:function(t,e){return t.contains?t.contains(e):t.compareDocumentPosition?!!(16&t.compareDocumentPosition(e)):void 0},getRect:function(t){return t.getBoundingClientRect()},isArray:function(t){return t&&"[object Array]"==={}.toString.call(t)},isString:function(t){return"string"==typeof t},proxy:function(t,e){return function(){return t.apply(e,arguments)}},each:function(t,e){if(t)if("length"in t&&"number"==typeof t.length)for(var r=0,i=t.length;i>r&&e.call(null,t[r],r,t)!==!1;r++);else for(var n in t)if(t.hasOwnProperty(n)&&e.call(null,t[n],n,t)===!1)break}};return r}},e[1]={value:function(){var t=e.r(20);return t.createClass("Component",{constructor:function(){}})}},e[2]={value:function(){function t(){return++i}var r={},i=0,n=!0,o=e.r(3),s=e.r(0),a=function(t){var e=t.type,i=t.target,o=this.__kfe_eid,a=/^(?:before|after)/.test(e),h=r[o][e];return a||(l.trigger(i,"before"+e),n!==!1)?(s.each(h,function(e){return e&&e.call(i,t)===!1?n=!1:void 0}),void(a||l.trigger(i,"after"+e))):(n=!0,!1)},l={addEvent:function(e,i,n){var o=!0,s=null;e.__kfe_eid||(o=!1,e.__kfe_eid=t(),r[e.__kfe_eid]={}),s=r[e.__kfe_eid],s[i]||(o=!1,s[i]=[]),s[i].push(n),o||e.addEventListener(i,a,!1)},trigger:function(t,e,r){r=r||o.createEvent(e,r),t.dispatchEvent(r)}};return l}},e[3]={value:function(){return{createEvent:function(t){var e=document.createEvent("Event");return e.initEvent(t,!0,!0),e}}}},e[4]={value:function(){var t={},r=e.r(0);return r.extend(t,r,e.r(2)),t}},e[5]={value:function(){var t=e.r(20),r=e.r(8),i=t.createClass("ControllerComponent",{constructor:function(t){this.kfEditor=t,this.components={},this.initComponents()},initComponents:function(){this.components.listener=new r(this,this.kfEditor)}});return i}},e[6]={value:function(){var t={32:"\\,","s+219":"\\{","s+221":"\\}",220:"\\backslash","s+51":"\\#","s+52":"\\$","s+53":"\\%","s+54":"\\^","s+55":"\\&","s+189":"\\_","s+192":"\\~"};return{getReplaceString:function(e){return t[e]||null}}}},e[7]={value:function(){var t=e.r(20),r=e.r(4),i=e.r(6),n={LEFT:37,RIGHT:39,DELETE:8,INPUT:229};return t.createClass("InputComponent",{constructor:function(t,e){this.parentComponent=t,this.kfEditor=e,this.inputBox=this.createInputBox(),this.initServices(),this.initCommands(),this.initEvent()},initServices:function(){this.kfEditor.registerService("control.update.input",this,{updateInput:this.updateInput}),this.kfEditor.registerService("control.insert.string",this,{insertStr:this.insertStr})},initCommands:function(){this.kfEditor.registerCommand("focus",this,this.focus)},createInputBox:function(){var t=this.kfEditor.getContainer(),e=this.kfEditor.getDocument().createElement("input");return e.className="kf-editor-input-box",e.type="text",e.isTrusted=!1,t.appendChild(e),e},focus:function(){var t=null;this.inputBox.focus(),this.kfEditor.requestService("syntax.has.cursor.info")||(t=this.kfEditor.requestService("syntax.get.root.group.info"),this.kfEditor.requestService("syntax.update.record.cursor",{groupId:t.id,startOffset:0,endOffset:t.content.length}),this.kfEditor.requestService("control.update.input")),this.kfEditor.requestService("control.reselect")},setUntrusted:function(){this.inputBox.isTrusted=!1},setTrusted:function(){this.inputBox.isTrusted=!0},updateInput:function(){var t=this.kfEditor.requestService("syntax.serialization");this.setUntrusted(),this.inputBox.value=t.str,this.inputBox.selectionStart=t.startOffset,this.inputBox.selectionEnd=t.endOffset,this.inputBox.focus(),this.setTrusted()},insertStr:function(t){var e=this.kfEditor.requestService("syntax.serialization"),r=e.str;r=r.substring(0,e.startOffset)+" "+t+" "+r.substring(e.endOffset),this.restruct(r),this.updateInput(),this.kfEditor.requestService("ui.update.canvas.view")},initEvent:function(){var t=this;r.addEvent(this.inputBox,"keydown",function(e){var r=!1;if(e.ctrlKey)return void t.processUserCtrl(e);switch(e.keyCode){case n.INPUT:return;case n.LEFT:e.preventDefault(),t.leftMove(),r=!0;break;case n.RIGHT:e.preventDefault(),t.rightMove(),r=!0;break;case n.DELETE:e.preventDefault(),t.delete(),r=!0}r&&t.kfEditor.requestService("ui.update.canvas.view"),t.pretreatmentInput(e)||e.preventDefault()}),r.addEvent(this.inputBox,"input",function(){t.processingInput()}),r.addEvent(this.inputBox,"blur",function(){t.kfEditor.requestService("ui.toolbar.disable"),t.kfEditor.requestService("ui.toolbar.close"),t.kfEditor.requestService("control.cursor.hide"),t.kfEditor.requestService("render.clear.select")}),r.addEvent(this.inputBox,"focus",function(){t.kfEditor.requestService("ui.toolbar.enable"),this.isTrusted&&t.kfEditor.requestService("control.reselect")}),r.addEvent(this.inputBox,"paste",function(t){t.preventDefault()})},hasRootplaceholder:function(){return this.kfEditor.requestService("syntax.has.root.placeholder")},leftMove:function(){this.hasRootplaceholder()||(this.kfEditor.requestService("syntax.cursor.move.left"),this.update())},rightMove:function(){this.hasRootplaceholder()||(this.kfEditor.requestService("syntax.cursor.move.right"),this.update())},"delete":function(){var t=null;this.hasRootplaceholder()||(t=this.kfEditor.requestService("syntax.delete.group"),t?(this.updateInput(),this.processingInput()):(this.updateInput(),this.kfEditor.requestService("control.reselect")))},processUserCtrl:function(t){switch(t.preventDefault(),t.keyCode){case 65:this.kfEditor.requestService("control.select.all");break;case 83:this.kfEditor.requestService("print.image")}},pretreatmentInput:function(t){var e=this.getKeyCode(t),r=i.getReplaceString(e);return null===r?!0:(this.insertStr(r),!1)},getKeyCode:function(t){return(t.shiftKey?"s+":"")+t.keyCode},processingInput:function(){this.restruct(this.inputBox.value),this.kfEditor.requestService("ui.update.canvas.view")},restruct:function(t){this.kfEditor.requestService("render.draw",t),this.kfEditor.requestService("control.reselect")},update:function(){this.updateInput(),this.kfEditor.requestService("control.reselect")}})}},e[8]={value:function(){var t=e.r(20),r=e.r(9),i=e.r(7),n=e.r(10);return t.createClass("MoveComponent",{constructor:function(t,e){this.parentComponent=t,this.kfEditor=e,this.components={},this.initComponents()},initComponents:function(){this.components.location=new r(this,this.kfEditor),this.components.selection=new n(this,this.kfEditor),this.components.input=new i(this,this.kfEditor)}})}},e[9]={value:function(){function t(t){return t.getBoundingClientRect()}var r=e.r(20);return r.createClass("LocationComponent",{constructor:function(t,e){this.parentComponent=t,this.kfEditor=e,this.paper=this.getPaper(),this.cursorShape=this.createCursor(),this.initServices(),this.initEvent()},getPaper:function(){return this.kfEditor.requestService("render.get.paper")},initServices:function(){this.kfEditor.registerService("control.cursor.relocation",this,{relocationCursor:this.updateCursor}),this.kfEditor.registerService("control.cursor.hide",this,{hideCursor:this.hideCursor}),this.kfEditor.registerService("control.reselect",this,{reselect:this.reselect}),this.kfEditor.registerService("control.get.cursor.location",this,{getCursorLocation:this.getCursorLocation})},createCursor:function(){var t=new r.Rect(1,0,0,0).fill("black");return t.setAttr("style","display: none"),this.paper.addShape(t),t},initEvent:function(){var t=this.kfEditor.request("ui.canvas.container.event"),e=this;t.on("mousedown",function(t){t.preventDefault(),e.updateCursorInfo(t),e.kfEditor.requestService("control.update.input"),e.reselect()})},updateCursorInfo:function(t){var e=null,r=null,i=-1;return this.kfEditor.requestService("syntax.has.root.placeholder")?(this.kfEditor.requestService("syntax.update.record.cursor",{groupId:this.kfEditor.requestService("syntax.get.root.group.info").id,startOffset:0,endOffset:1}),!1):(e=this.kfEditor.requestService("position.get.wrap",t.target),e&&this.kfEditor.requestService("syntax.is.placeholder.node",e.id)?(r=this.kfEditor.requestService("position.get.group.info",e),void this.kfEditor.requestService("syntax.update.record.cursor",r.group.id,r.index,r.index+1)):(r=this.kfEditor.requestService("position.get.group",t.target),null===r&&(r=this.kfEditor.requestService("syntax.get.root.group.info")),i=this.getIndex(t.clientX,r),void this.kfEditor.requestService("syntax.update.record.cursor",r.id,i)))},hideCursor:function(){this.cursorShape.setAttr("style","display: none")},reselect:function(){var t=this.kfEditor.requestService("syntax.get.record.cursor"),e=null;return this.hideCursor(),this.kfEditor.requestService("syntax.is.select.placeholder")?(e=this.kfEditor.requestService("syntax.get.group.content",t.groupId),void this.kfEditor.requestService("render.select.group",e.content[t.startOffset].id)):void(t.startOffset===t.endOffset?(this.updateCursor(),this.kfEditor.requestService("render.tint.current.cursor")):this.kfEditor.requestService("render.select.current.cursor"))},updateCursor:function(){var e=this.kfEditor.requestService("syntax.get.record.cursor");if(e.startOffset!==e.endOffset)return void this.hideCursor();var r=this.kfEditor.requestService("syntax.get.group.content",e.groupId),i=0===e.endOffset,n=i?0:e.endOffset-1,o=r.content[n],s=t(this.paper.container.node),a=0,l=t(o),h=this.cursorShape.getTransform(this.cursorShape),c=this.kfEditor.requestService("render.get.canvas.zoom"),u=this.paper.getZoom();this.cursorShape.setHeight(l.height/c/u),a=i?l.left-2:l.left+l.width-2,a-=s.left,h.m.e=Math.floor(a/c/u)+.5,h.m.f=(l.top-s.top)/c/u,this.cursorShape.setMatrix(h),this.cursorShape.setAttr("style","display: block")},getCursorLocation:function(){var t=this.cursorShape.getRenderBox("paper");return{x:t.x,y:t.y}},getIndex:function(e,r){for(var i=-1,n=r.content,o=null,s=n.length-1,a=null;s>=0;s--)if(i=s,a=n[s],o=t(a),o.left<e){o.left+o.width/2<e&&(i+=1);break}return i}})}},e[10]={value:function(){var t=e.r(20),r=e.r(4),i=10;return t.createClass("SelectionComponent",{constructor:function(t,e){this.parentComponent=t,this.kfEditor=e,this.isDrag=!1,this.isMousedown=!1,this.startPoint={x:-1,y:-1},this.startGroupIsPlaceholder=!1,this.startGroup={},this.initServices(),this.initEvent()},initServices:function(){this.kfEditor.registerService("control.select.all",this,{selectAll:this.selectAll})},initEvent:function(){var t=this.kfEditor.request("ui.canvas.container.event"),e=this;t.on("mousedown",function(t){return t.preventDefault(),e.kfEditor.requestService("syntax.has.root.placeholder")?!1:(e.isMousedown=!0,e.updateStartPoint(t.clientX,t.clientY),void e.updateStartGroup())}),t.on("mouseup",function(t){t.preventDefault(),e.stopUpdateSelection()}),t.on("mousemove",function(t){if(t.preventDefault(),e.isDrag){if(1!==t.which)return void e.stopUpdateSelection();e.updateSelection(t.target,t.clientX,t.clientY)}else e.isMousedown&&i<e.getDistance(t.clientX,t.clientY)&&(e.kfEditor.requestService("control.cursor.hide"),e.startUpdateSelection())}),t.on("dblclick",function(t){e.updateSelectionByTarget(t.target)})},getDistance:function(t,e){var r=Math.abs(t-this.startPoint.x),i=Math.abs(e-this.startPoint.y);return Math.max(r,i)},updateStartPoint:function(t,e){this.startPoint.x=t,this.startPoint.y=e},updateStartGroup:function(){var t=this.kfEditor.requestService("syntax.get.record.cursor");this.startGroupIsPlaceholder=this.kfEditor.requestService("syntax.is.select.placeholder"),this.startGroup={groupInfo:this.kfEditor.requestService("syntax.get.group.content",t.groupId),offset:t.startOffset}},startUpdateSelection:function(){this.isDrag=!0,this.isMousedown=!1,this.clearSelection()},stopUpdateSelection:function(){this.isDrag=!1,this.isMousedown=!1,this.kfEditor.requestService("control.update.input")},clearSelection:function(){this.kfEditor.requestService("render.clear.select")},updateSelection:function(t,e){var i=e>this.startPoint.x,n={},o=null,s=!1,a=this.startGroup,l=null,h=this.getGroupInof(e,t);h.groupInfo.id===a.groupInfo.id?(n={groupId:h.groupInfo.id,startOffset:a.offset,endOffset:h.offset},this.startGroupIsPlaceholder&&(i?n.startOffset===n.endOffset&&(n.endOffset+=1):n.startOffset+=1)):r.contains(a.groupInfo.groupObj,h.groupInfo.groupObj)?n={groupId:a.groupInfo.id,startOffset:a.offset,endOffset:this.getIndex(a.groupInfo.groupObj,t,e)}:r.contains(h.groupInfo.groupObj,a.groupInfo.groupObj)?(n={groupId:h.groupInfo.id,startOffset:this.kfEditor.requestService("position.get.index",h.groupInfo.groupObj,a.groupInfo.groupObj),endOffset:h.offset},i||(n.startOffset+=1)):(o=this.getCommunityGroup(a.groupInfo,h.groupInfo),o.startOffset===o.endOffset?o.endOffset+=1:(l=o.group.content[o.endOffset],s=this.kfEditor.requestService("position.get.area",l,e),s&&(o.endOffset+=1),i||(o.startOffset+=1)),n={groupId:o.group.id,startOffset:o.startOffset,endOffset:o.endOffset}),this.kfEditor.requestService("syntax.update.record.cursor",n.groupId,n.startOffset,n.endOffset),this.kfEditor.requestService("control.reselect")},updateSelectionByTarget:function(t){var e=this.kfEditor.requestService("position.get.parent.group",t),r=null,i={};if(null!==e){if(this.kfEditor.requestService("syntax.is.root.node",e.id))return void this.selectAll();this.kfEditor.requestService("syntax.is.virtual.node",e.id)?(r=this.kfEditor.requestService("position.get.group.info",e.groupObj),i={groupId:r.group.id,startOffset:r.index,endOffset:r.index+1}):i={groupId:e.id,startOffset:0,endOffset:e.content.length},this.kfEditor.requestService("syntax.update.record.cursor",i),this.kfEditor.requestService("control.reselect"),this.kfEditor.requestService("control.update.input")}},selectAll:function(){var t=this.kfEditor.requestService("syntax.get.root.group.info"),e={groupId:t.id,startOffset:0,endOffset:t.content.length};this.kfEditor.requestService("syntax.update.record.cursor",e),this.kfEditor.requestService("control.reselect"),this.kfEditor.requestService("control.update.input")},getGroupInof:function(t,e){var r=this.kfEditor.requestService("position.get.group",e);null===r&&(r=this.kfEditor.requestService("syntax.get.root.group.info"));var i=this.kfEditor.requestService("position.get.location.info",t,r);return{groupInfo:r,offset:i}},getIndex:function(t,e,i){var n=this.kfEditor.requestService("position.get.index",t,e),o=this.kfEditor.requestService("syntax.get.group.content",t.id),s=o.content[n],a=r.getRect(s);return a.left+a.width/2<i&&(n+=1),n},getCommunityGroup:function(t,e){for(var i=null,n=t.groupObj,o=null;(i=this.kfEditor.requestService("position.get.group.info",n))&&(n=i.group.groupObj,!r.contains(i.group.groupObj,e.groupObj)););return o=i.group.groupObj,{group:i.group,startOffset:i.index,endOffset:this.kfEditor.requestService("position.get.index",o,e.groupObj)}}})}},e[11]={value:function(){return{GROUP:"kf-editor-group",VIRTUAL:"kf-editor-virtual-group"}}},e[12]={value:function(){function t(t){var e=this.services[t];if(!e)throw new Error("KFEditor: not found service, "+t);return e}var r=e.r(20),i=e.r(4),n={formula:{fontsize:50,autoresize:!1},ui:{zoom:!0,maxzoom:2,minzoom:1}},o={},s=e.r(19).ResourceManager,a=r.createClass("KFEditor",{constructor:function(t,e){this.options=i.extend(!0,{},n,e),this.FormulaClass=null,this._readyState=!1,this._callbacks=[],this.container=t,this.services={},this.commands={},this.initResource()},isReady:function(){return!!this._readyState},triggerReady:function(){for(var t=null,e=this;t=this._callbacks.shift();)t.call(e,e)},ready:function(t){this._readyState?t.call(this,this):this._callbacks.push(t)},getContainer:function(){return this.container},getDocument:function(){return this.container.ownerDocument},getFormulaClass:function(){return this.FormulaClass},getOptions:function(){return this.options},initResource:function(){var t=this;s.ready(function(e){t.FormulaClass=e,t.initComponents(),t._readyState=!0,t.triggerReady()},this.options.resource)},initComponents:function(){var t=this;i.each(o,function(e,r){new e(t,t.options[r])})},requestService:function(e){var r=t.call(this,e);return r.service[r.key].apply(r.provider,[].slice.call(arguments,1))},request:function(e){var r=t.call(this,e);return r.service},registerService:function(t,e,r){var n=null;for(n in r)r[n]&&r.hasOwnProperty(n)&&(r[n]=i.proxy(r[n],e));this.services[t]={provider:e,key:n,service:r}},registerCommand:function(t,e,r){this.commands[t]={executor:e,execFn:r}},execCommand:function(t){var e=this.commands[t];if(!e)throw new Error("KFEditor: not found command, "+t);return e.execFn.apply(e.executor,[].slice.call(arguments,1))}});return i.extend(a,{registerComponents:function(t,e){o[t]=e}}),a}},e[13]={value:function(){function t(t,e){var r=this;this._callbacks=[],this.editor=new i(t,e),this.editor.ready(function(){r._trigger()})}var r=e.r(20),i=e.r(12);return t.prototype._trigger=function(){var t=this.editor;r.Utils.each(this._callbacks,function(e){e.call(t,t)})},t.prototype.ready=function(t){this.editor.isReady()?t.call(this.editor,this.editor):this._callbacks.push(t)},{create:function(e,r){return new t(e,r)}}}},e[14]={value:function(){return window.jQuery}},e[15]={value:function(){return{selectColor:"rgba(42, 106, 189, 0.2)",allSelectColor:"rgba(42, 106, 189, 0.6)"}}},e[16]={value:function(){var t=e.r(20),r=e.r(19),i=e.r(18);return t.createClass("PlaceholderExpression",{base:r.CompoundExpression,constructor:function(){this.callBase(),this.setFlag("Placeholder"),this.label=null,this.box.setAttr("data-type",null),this.setOperator(new i)},setLabel:function(t){this.label=t},getLabel:function(){return this.label},setAttr:function(t,e){"label"===t?this.setLabel(e):(t.label&&(this.setLabel(t.label),delete t.label),this.callBase(t,e))},select:function(){this.getOperator().select()},selectAll:function(){this.getOperator().selectAll()},unselect:function(){this.getOperator().unselect()}})}},e[17]={value:function(){function t(t){r.PlaceholderExpression=e.r(16),r.Expression.prototype.select=function(){this.box.fill(i)},r.Expression.prototype.selectAll=function(){this.box.fill(n)},r.Expression.prototype.unselect=function(){this.box.fill("transparent")},t.getKFParser().expand({parse:{placeholder:{name:"placeholder",handler:function(t){return delete t.handler,t.operand=[],t},sign:!1}},reverse:{placeholder:function(){return"\\placeholder "}}})}var r=e.r(19),i=e.r(15).selectColor,n=e.r(15).allSelectColor;return{ext:t}}},e[18]={value:function(){function t(t,e){return null!==e?i(t,e):r(t)}function r(t){var e=35,r=50,i=null;return i=new n.Rect(e,r,0,0).stroke("black").fill("transparent"),i.setAttr("stroke-dasharray","5, 5"),t.addOperatorShape(i),i}function i(t,e){var r=new n.Text(e).fill(o),i=new n.Group,s=2,a=7,l=new n.Rect(0,0,0,0,a).stroke(o).fill("transparent"),h=null;return r.setFontSize(40),i.addShape(l),i.addShape(r),t.addOperatorShape(i),h=r.getFixRenderBox(),l.stroke(o).fill("transparent"),l.setSize(h.width+2*s,h.height+2*s),l.setRadius(a),l.setAttr("stroke-dasharray","5, 5"),r.setAttr({dx:0-h.x,dy:0-h.y}),r.translate(s,s),l}var n=e.r(20),o=e.r(29).rootPlaceholder.color,s=e.r(15).selectColor,a=e.r(15).allSelectColor;return n.createClass("PlaceholderOperator",{base:e.r(19).Operator,constructor:function(){this.opShape=null,this.callBase("Placeholder")},applyOperand:function(){this.opShape=t(this,this.parentExpression.getLabel()),this.parentExpression.expand(20,20),this.parentExpression.translateElement(10,10)},select:function(){this.opShape.fill(s)},selectAll:function(){this.opShape.fill(a)},unselect:function(){this.opShape.fill("transparent")}})}},e[19]={value:function(){return window.kf}},e[20]={value:function(){return window.kity}},e[21]={value:function(){function t(t,e,r){var l=null,h=!r;e.attr=e.attr||{},e.attr.id=t.getGroupId(),h?i(t,e):r.attr["data-root"]&&"placeholder"===e.name&&s(r.operand)&&(e.attr.label=f);for(var c=0,u=e.operand.length;u>c;c++)l=e.operand[c],a(e)?n(t,c,e,l):o(t,c,e,l);return e}function r(){return m+ ++x}function i(t,e){t.isResetId?e.attr["data-root"]="true":e.attr["data-type"]=v.VIRTUAL}function n(e,r,i,n){"brackets"===i.name&&2>r||("function"!==i.name||0!==r)&&(i.attr["data-type"]=v.VIRTUAL,n?"string"==typeof n?(i.operand[r]=h(e),i.operand[r].operand[0]=n):l(n)?(i.operand[r]=h(e),i.operand[r].operand[0]=t(e,n,i.operand[r])):i.operand[r]=t(e,n,i):i.operand[r]=n)}function o(e,r,i,n){i.attr["data-type"]=v.GROUP,i.operand[r]=n&&"string"!=typeof n?"text"===n.name?n:t(e,n,i):n}function s(t){var e=1;if(t.length>3)return!1;for(var r=0,i=t.length;i>r;r++)t[r]!==d&&t[r]&&"placeholder"===t[r].name&&e--;return!e}function a(t){return!!p[t.name]}function l(t){return"placeholder"===t.name}function h(t){return{name:g,attr:{"data-type":v.GROUP,id:t.getGroupId()},operand:[]}}var c=e.r(19).Parser,u=e.r(20),d=e.r(29).cursorCharacter,p=e.r(22),f=e.r(29).rootPlaceholder.content,g="combination",m="_kf_editor_",v=e.r(11),x=0,b=u.createClass("Parser",{constructor:function(t){this.kfEditor=t,this.callBase(),this.kfParser=c.use("latex"),this.initKFormulExtension(),this.pid=r(),this.groupRecord=0,this.tree=null,this.isResetId=!0,this.initServices()},parse:function(e,r){var i=null;return this.isResetId=!!r,this.isResetId&&this.resetGroupId(),i=this.kfParser.parse(e),t(this,i.tree),i},serialization:function(t){return this.kfParser.serialization(t)},initServices:function(){this.kfEditor.registerService("parser.parse",this,{parse:this.parse}),this.kfEditor.registerService("parser.latex.serialization",this,{serialization:this.serialization})},getKFParser:function(){return this.kfParser},initKFormulExtension:function(){e.r(17).ext(this)},resetGroupId:function(){this.groupRecord=0},getGroupId:function(){return this.pid+"_"+ ++this.groupRecord}});return b}},e[22]={value:function(){return{radical:!0,fraction:!0,summation:!0,integration:!0,placeholder:!0,script:!0,superscript:!0,subscript:!0,brackets:!0,"function":!0,stackrel:!0,underline:!0,overline:!0,widehat:!0,underbrace:!0}}},e[23]={value:function(){function t(e,r,i){var n=null;return e.ownerSVGElement?(e=e.parentNode,n=e.tagName.toLowerCase(),e&&"body"!==n&&"svg"!==n?"kf-editor-group"===e.getAttribute("data-type")?e:r&&"kf-editor-virtual-group"===e.getAttribute("data-type")?e:i&&null!==e.getAttribute("data-flag")?e:t(e,r,i):null):null}var r=e.r(20),i=e.r(4),n=r.createClass("PositionComponenet",{constructor:function(t){this.kfEditor=t,this.initServices()},initServices:function(){this.kfEditor.registerService("position.get.group",this,{getGroupByTarget:this.getGroupByTarget}),this.kfEditor.registerService("position.get.index",this,{getIndexByTargetInGroup:this.getIndexByTargetInGroup}),this.kfEditor.registerService("position.get.location.info",this,{getLocationInfo:this.getLocationInfo}),this.kfEditor.registerService("position.get.parent.group",this,{getParentGroupByTarget:this.getParentGroupByTarget}),this.kfEditor.registerService("position.get.wrap",this,{getWrap:this.getWrap}),this.kfEditor.registerService("position.get.area",this,{getAreaByCursorInGroup:this.getAreaByCursorInGroup}),this.kfEditor.registerService("position.get.group.info",this,{getGroupInfoByNode:this.getGroupInfoByNode}),this.kfEditor.registerService("position.get.parent.info",this,{getParentInfoByNode:this.getParentInfoByNode})},getGroupByTarget:function(e){var r=t(e,!1,!1);return r?this.kfEditor.requestService("syntax.get.group.content",r.id):null},getIndexByTargetInGroup:function(t,e){var n=this.kfEditor.requestService("syntax.get.group.content",t.id),o=-1;return r.Utils.each(n.content,function(t,r){return o=r,i.contains(t,e)?!1:void 0}),o},getAreaByCursorInGroup:function(t,e){var r=i.getRect(t);return r.left+r.width/2<e},getLocationInfo:function(t,e){for(var r=-1,n=e.content,o=null,s=n.length-1,a=null;s>=0;s--)if(r=s,a=n[s],o=i.getRect(a),o.left<t){o.left+o.width/2<t&&(r+=1);break}return r},getParentGroupByTarget:function(e){var r=t(e,!0,!1);return r?this.kfEditor.requestService("syntax.get.group.content",r.id):null},getWrap:function(e){return t(e,!0,!0)},getGroupInfoByNode:function(e){var r={},n=t(e,!1,!1),o=null;if(!n)return null;o=this.kfEditor.requestService("syntax.get.group.content",n.id);for(var s=0,a=o.content.length;a>s&&(r.index=s,!i.contains(o.content[s],e));s++);return r.group=o,r},getParentInfoByNode:function(e){var r=t(e,!0,!1);return r=this.kfEditor.requestService("syntax.get.group.content",r.id),{group:r,index:r.content.indexOf(e)}}});return n}},e[24]={value:function(){var t=e.r(20);return t.createClass("Printer",{constructor:function(t){this.kfEditor=t,this.initServices(),this.initCommands()},initServices:function(){this.kfEditor.registerService("print.image",this,{printImage:this.printImage})},initCommands:function(){this.kfEditor.registerCommand("get.image.data",this,this.getImageData)},printImage:function(){var t=this.kfEditor.requestService("render.get.paper");this._formatCanvas(),t.toPNG(function(t){document.body.innerHTML='<img style="background: red;" src="'+t+'">'}),this._restoreCanvas()},getImageData:function(t){var e=this.kfEditor.requestService("render.get.canvas"),r=this.kfEditor.requestService("render.get.paper");this._formatCanvas(),r.toPNG(function(r){t({width:e.width,height:e.height,img:r})}),this._restoreCanvas()},_formatCanvas:function(){var t=this.kfEditor.requestService("render.get.canvas"),e=t.container.getRenderBox();t.node.setAttribute("width",e.width),t.node.setAttribute("height",e.height),this.kfEditor.requestService("render.clear.canvas.transform"),this.kfEditor.requestService("control.cursor.hide"),this.kfEditor.requestService("render.clear.select")},_restoreCanvas:function(){var t=this.kfEditor.requestService("render.get.canvas");t.node.setAttribute("width","100%"),t.node.setAttribute("height","100%"),this.kfEditor.requestService("render.revert.canvas.transform"),this.kfEditor.requestService("control.cursor.relocation"),this.kfEditor.requestService("render.reselect")}})}},e[25]={value:function(){var t=e.r(20),r=e.r(19).Assembly,i={autoresize:!1,fontsize:50,padding:[2,5]},n=t.createClass("RenderComponent",{base:e.r(1),constructor:function(e,r){this.callBase(),this.options=t.Utils.extend({},i,r),this.kfEditor=e,this.assembly=null,this.formula=null,this.relDisabled=!1,this.canvasZoom=1,this.record={select:{},cursor:{},canvas:{}},this.initCanvas(),this.initServices(),this.initCommands()},initCanvas:function(){var t=this.kfEditor.requestService("ui.get.canvas.container"),e=this.kfEditor.getFormulaClass();this.assembly=new r(new e(t,this.options)),this.formula=this.assembly.formula,this.setCanvasToCenter()},setCanvasOffset:function(t,e){var r=this.formula.getViewBox();e=void 0!==e?e:-r.height/2,this.formula.setViewBox(t,e,r.width,r.height)},setCanvasToCenter:function(){var t=this.formula.getViewBox();this.formula.setViewBox(-t.width/2,-t.height/2,t.width,t.height)},initServices:function(){this.kfEditor.registerService("render.get.canvas",this,{getCanvas:this.getCanvas}),this.kfEditor.registerService("render.get.content.size",this,{getContentSize:this.getContentSize}),this.kfEditor.registerService("render.clear.canvas.transform",this,{clearCanvasOffset:this.clearCanvasTransform}),this.kfEditor.registerService("render.set.canvas.offset",this,{setCanvasOffset:this.setCanvasOffset}),this.kfEditor.registerService("render.set.canvas.to.center",this,{setCanvasToCenter:this.setCanvasToCenter}),this.kfEditor.registerService("render.revert.canvas.transform",this,{revertCanvasTransform:this.revertCanvasTransform}),this.kfEditor.registerService("render.relocation",this,{relocation:this.relocation}),this.kfEditor.registerService("render.disable.relocation",this,{disableRelocation:this.disableRelocation}),this.kfEditor.registerService("render.enable.relocation",this,{enableRelocation:this.enableRelocation}),this.kfEditor.registerService("render.select.group.content",this,{selectGroupContent:this.selectGroupContent}),this.kfEditor.registerService("render.select.group",this,{selectGroup:this.selectGroup}),this.kfEditor.registerService("render.select.group.all",this,{selectAllGroup:this.selectAllGroup}),this.kfEditor.registerService("render.tint.current.cursor",this,{tintCurrentGroup:this.tintCurrentGroup}),this.kfEditor.registerService("render.select.current.cursor",this,{selectCurrentCursor:this.selectCurrentCursor}),this.kfEditor.registerService("render.reselect",this,{reselect:this.reselect}),this.kfEditor.registerService("render.clear.select",this,{clearSelect:this.clearSelect}),this.kfEditor.registerService("render.set.canvas.zoom",this,{setCanvasZoom:this.setCanvasZoom}),this.kfEditor.registerService("render.get.canvas.zoom",this,{getCanvasZoom:this.getCanvasZoom}),this.kfEditor.registerService("render.get.paper.offset",this,{getPaperOffset:this.getPaperOffset}),this.kfEditor.registerService("render.draw",this,{render:this.render}),this.kfEditor.registerService("render.insert.string",this,{insertString:this.insertString}),this.kfEditor.registerService("render.insert.group",this,{insertGroup:this.insertGroup}),this.kfEditor.registerService("render.get.paper",this,{getPaper:this.getPaper})},initCommands:function(){this.kfEditor.registerCommand("render",this,function(t){this.render(t),this.kfEditor.requestService("ui.update.canvas.view")}),this.kfEditor.registerCommand("getPaper",this,this.getPaper)},relocation:function(){this.relDisabled?this.relocationToLeft():this.relocationToCenter()},relocationToCenter:function(){var t=this.formula.container.getRenderBox();this.formula.container.setTranslate(-t.width/2,-t.height/2),this.setCanvasToCenter()},relocationToLeft:function(){var t=this.formula.container.getRenderBox();this.formula.container.setTranslate(0,-t.height/2),this.setCanvasOffset(0)},selectGroup:function(t){var e=this.kfEditor.requestService("syntax.get.group.object",t);this.clearSelect(),e.node.getAttribute("data-root")||(this.record.select.lastSelect=e,e.select())},selectGroupContent:function(t){null!==t.groupObj.getAttribute("data-placeholder")&&(t={id:t.content[0].id});var e=this.kfEditor.requestService("syntax.get.group.object",t.id);this.clearSelect(),this.record.select.lastSelect=e,e.node.getAttribute("data-root")||e.select()},selectAllGroup:function(t){null!==t.groupObj.getAttribute("data-placeholder")&&(t={id:t.content[0].id});var e=this.kfEditor.requestService("syntax.get.group.object",t.id);this.clearSelect(),this.record.select.lastSelect=e,e.selectAll()},selectCurrentCursor:function(){var t=this.kfEditor.requestService("syntax.get.record.cursor"),e=this.kfEditor.requestService("syntax.get.group.object",t.groupId),r=null,i=-1,n=0,o=Math.min(t.startOffset,t.endOffset),s=Math.max(t.startOffset,t.endOffset);this.clearSelect(),this.record.select.lastSelect=e;for(var a=o,l=s;l>a;a++)r=e.getOperand(a).getRenderBox(e),-1==i&&(i=r.x),n+=r.width;e.setBoxWidth(n),e.selectAll(),e.getBox().setTranslate(i,0)},tintCurrentGroup:function(){var t=this.kfEditor.requestService("syntax.get.record.cursor").groupId,e=this.kfEditor.requestService("syntax.get.group.object",t),r=this.kfEditor.requestService("syntax.is.placeholder.node",t);this.clearSelect(),e.node.getAttribute("data-root")||(r&&(e=this.kfEditor.requestService("syntax.get.group.object",e.operands[0].node.id)),this.record.select.lastSelect=e,e.select())},reselect:function(){var t=this.kfEditor.requestService("syntax.get.record.cursor"),e=null;e=this.kfEditor.requestService("syntax.get.group.object",t.groupId),this.clearSelect(),this.record.select.lastSelect=e,e.node.getAttribute("data-root")||e.select()
},clearSelect:function(){var t=null,e=this.record.select.lastSelect;e&&e.node.ownerSVGElement&&(e.unselect(),t=e.getRenderBox(e),e.setBoxWidth(t.width),e.getBox().setTranslate(0,0))},getPaper:function(){return this.formula},render:function(t){var e=this.kfEditor.requestService("parser.parse",t,!0),r=this.assembly.regenerateBy(e);this.kfEditor.requestService("syntax.update.objtree",r)},enableRelocation:function(){this.relDisabled=!1},disableRelocation:function(){this.relDisabled=!0},setCanvasZoom:function(t){var e=this.formula.getViewPort();this.canvasZoom=t,e.zoom=t,this.formula.setViewPort(e)},getCanvas:function(){return this.formula},getContentSize:function(){return this.formula.container.getRenderBox()},clearCanvasTransform:function(){var t=this.record.canvas;t.viewBox=this.formula.getViewBox(),t.contentOffset=this.formula.container.getTranslate(),this.setCanvasToCenter(),this.formula.node.removeAttribute("viewBox"),this.formula.container.setTranslate(0,0)},revertCanvasTransform:function(){var t=this.record.canvas,e=t.viewBox;return e?(this.formula.setViewBox(e.x,e.y,e.width,e.height),this.formula.container.setTranslate(t.contentOffset),t.viewBox=null,void(t.contentOffset=null)):!1},getCanvasZoom:function(){return this.canvasZoom}});return n}},e[26]={value:function(){var t=e.r(20);return t.createClass("DeleteComponent",{constructor:function(t,e){this.parentComponent=t,this.kfEditor=e},deleteGroup:function(){var t=this.parentComponent.getCursorRecord(),e=this.parentComponent.getObjectTree(),r=e.mapping[t.groupId].strGroup;return t.startOffset!==t.endOffset?this.parentComponent.isSelectPlaceholder()?this.parentComponent.isRootTree(r)?!1:(t=this.selectParentContainer(t.groupId),this.parentComponent.updateCursor(t),!1):this.deleteSelection(r,t):0===t.startOffset?this.parentComponent.isRootTree(r)?!1:(t=this.selectParentContainer(t.groupId),this.parentComponent.updateCursor(t),!1):r.operand.length>1?(t=this.deletePrevGroup(r,t),this.parentComponent.updateCursor(t),t.startOffset===t.endOffset?!0:!1):(t.startOffset=0,t.endOffset=1,r.operand[0].attr&&this.parentComponent.isGroupNode(r.operand[0].attr.id)?(this.parentComponent.updateCursor(t),!1):(r.operand[0]={name:"placeholder",operand:[]},this.parentComponent.updateCursor(t),!0))},deletePrevGroup:function(t,e){var r=e.startOffset-1,i=t.operand[r];return this.parentComponent.isLeafTree(i)?(t.operand.splice(r,1),e.startOffset-=1,e.endOffset-=1):e.startOffset-=1,e},deleteSelection:function(t,e){return 0===e.startOffset&&e.endOffset===t.operand.length?(t.operand.length=1,t.operand[0]={name:"placeholder",operand:[]},e.endOffset=1):(t.operand.splice(e.startOffset,e.endOffset-e.startOffset),e.endOffset=e.startOffset),this.parentComponent.updateCursor(e),!0},selectParentContainer:function(t){var e=this.parentComponent.getGroupObject(t).node,r=this.kfEditor.requestService("position.get.group",e),i=this.kfEditor.requestService("position.get.index",r.groupObj,e);return{groupId:r.id,startOffset:i,endOffset:i+1}}})}},e[27]={value:function(){function t(t){var e=null,r=this.parentComponent,o=null;return o=r.getGroupContent(t.groupId),r.isSelectPlaceholder()?n(this,o.content[t.startOffset],g.LEFT):(t.startOffset===t.endOffset?t.startOffset>0?(e=o.content[t.startOffset-1],u(e)?t=i(this,e,g.LEFT):(t.startOffset-=1,d(e)||(t.endOffset=t.startOffset))):t=n(this,o.groupObj,g.LEFT):(t.startOffset=Math.min(t.startOffset,t.endOffset),t.endOffset=t.startOffset),t)}function r(t){var e=null,r=this.parentComponent,o=null;return o=r.getGroupContent(t.groupId),r.isSelectPlaceholder()?n(this,o.content[t.startOffset],g.RIGHT):(t.startOffset===t.endOffset?t.startOffset<o.content.length?(e=o.content[t.startOffset],u(e)?t=i(this,e,g.RIGHT):(t.startOffset+=1,d(e)||(t.endOffset=t.startOffset))):t=n(this,o.groupObj,g.RIGHT):(t.endOffset=Math.max(t.startOffset,t.endOffset),t.startOffset=t.endOffset),t)}function i(t,e,r){switch(r){case g.LEFT:return o(t,e);case g.RIGHT:return a(t,e)}throw new Error("undefined move direction!")}function n(t,e,r){switch(r){case g.LEFT:return s(t,e);case g.RIGHT:return l(t,e)}throw new Error("undefined move direction!")}function o(t,e){var r=t.parentComponent,i=null,n=null;if(d(e)||p(e))return s(t,e);if(u(e)){if(i=r.getGroupContent(e.id),n=i.content[i.content.length-1],p(n))return s(t,n);if(c(e))return d(n)?{groupId:e.id,startOffset:i.content.length-1,endOffset:i.content.length}:c(n)&&1===i.content.length?o(t,n):{groupId:e.id,startOffset:i.content.length,endOffset:i.content.length};for(;!c(n)&&!p(n)&&!d(n);)i=r.getGroupContent(n.id),n=i.content[i.content.length-1];return p(n)?s(t,n):d(n)?{groupId:n.id,startOffset:i.content.length,endOffset:i.content.length}:o(t,n)}return null}function s(t,e){var r=t.kfEditor,i=null;if(h(e))return null;for(i=r.requestService("position.get.parent.info",e);0===i.index;){if(h(i.group.groupObj))return{groupId:i.group.id,startOffset:0,endOffset:0};if(c(i.group.groupObj)&&i.group.content.length>1)return{groupId:i.group.id,startOffset:0,endOffset:0};i=r.requestService("position.get.parent.info",i.group.groupObj)}return c(i.group.groupObj)?{groupId:i.group.id,startOffset:i.index,endOffset:i.index}:(e=i.group.content[i.index-1],u(e)?c(e)?o(t,e):o(t,e):p(e)?s(t,e):{groupId:i.group.id,startOffset:i.index,endOffset:i.index})}function a(t,e){var r=t.parentComponent,i=null,n=null;if(u(e)){if(i=r.getGroupContent(e.id),n=i.content[0],c(e))return c(n)?a(t,n):d(n)?{groupId:e.id,startOffset:0,endOffset:1}:{groupId:e.id,startOffset:0,endOffset:0};for(;!c(n)&&!d(n)&&!p(n);)i=r.getGroupContent(n.id),n=i.content[0];return d(n)?{groupId:n.id,startOffset:0,endOffset:0}:p(n)?l(t,n):a(t,n)}return null}function l(t,e){var r=t.kfEditor,i=t.parentComponent,n=null,o=null;if(h(e))return null;for(n=r.requestService("position.get.parent.info",e);n.index===n.group.content.length-1;){if(h(n.group.groupObj))return{groupId:n.group.id,startOffset:n.group.content.length,endOffset:n.group.content.length};if(c(n.group.groupObj)&&n.group.content.length>1)return{groupId:n.group.id,startOffset:n.group.content.length,endOffset:n.group.content.length};n=r.requestService("position.get.parent.info",n.group.groupObj)}return e=n.group.content[n.index+1],p(e)?l(t,e):c(e)?(o=i.getGroupContent(e.id),i.isPlaceholder(o.content[0].id)?{groupId:e.id,startOffset:0,endOffset:1}:{groupId:e.id,startOffset:0,endOffset:0}):{groupId:n.group.id,startOffset:n.index+1,endOffset:n.index+1}}function h(t){return!!t.getAttribute("data-root")}function c(t){return"kf-editor-group"===t.getAttribute("data-type")}function u(t){var e=t.getAttribute("data-type");return"kf-editor-group"===e||"kf-editor-virtual-group"===e}function d(t){return"Placeholder"===t.getAttribute("data-flag")}function p(t){return"Empty"===t.getAttribute("data-flag")}var f=e.r(20),g={LEFT:"left",RIGHT:"right"};return f.createClass("MoveComponent",{constructor:function(t,e){this.parentComponent=t,this.kfEditor=e},leftMove:function(){var e=this.parentComponent.getCursorRecord();e=t.call(this,e),e&&this.parentComponent.updateCursor(e)},rightMove:function(){var t=this.parentComponent.getCursorRecord();t=r.call(this,t),t&&this.parentComponent.updateCursor(t)}})}},e[28]={value:function(){var t=e.r(20),r=e.r(27),i=e.r(26),n=e.r(29).cursorCharacter,o=e.r(11),s=t.createClass("SyntaxComponenet",{constructor:function(t){this.kfEditor=t,this.record={cursor:{group:null,startOffset:-1,endOffset:-1}},this.components={},this.objTree=null,this.initComponents(),this.initServices(),this.initCommands()},initComponents:function(){this.components.move=new r(this,this.kfEditor),this.components.delete=new i(this,this.kfEditor)},initServices:function(){this.kfEditor.registerService("syntax.update.objtree",this,{updateObjTree:this.updateObjTree}),this.kfEditor.registerService("syntax.get.objtree",this,{getObjectTree:this.getObjectTree}),this.kfEditor.registerService("syntax.get.group.object",this,{getGroupObject:this.getGroupObject}),this.kfEditor.registerService("syntax.is.root.node",this,{isRootNode:this.isRootNode}),this.kfEditor.registerService("syntax.is.group.node",this,{isGroupNode:this.isGroupNode}),this.kfEditor.registerService("syntax.is.virtual.node",this,{isVirtualNode:this.isVirtualNode}),this.kfEditor.registerService("syntax.is.placeholder.node",this,{isPlaceholder:this.isPlaceholder}),this.kfEditor.registerService("syntax.is.select.placeholder",this,{isSelectPlaceholder:this.isSelectPlaceholder}),this.kfEditor.registerService("syntax.has.root.placeholder",this,{hasRootplaceholder:this.hasRootplaceholder}),this.kfEditor.registerService("syntax.valid.brackets",this,{isBrackets:this.isBrackets}),this.kfEditor.registerService("syntax.get.group.content",this,{getGroupContent:this.getGroupContent}),this.kfEditor.registerService("syntax.get.root.group.info",this,{getRootGroupInfo:this.getRootGroupInfo}),this.kfEditor.registerService("syntax.get.root",this,{getRootObject:this.getRootObject}),this.kfEditor.registerService("syntax.update.record.cursor",this,{updateCursor:this.updateCursor}),this.kfEditor.registerService("syntax.update.selection",this,{updateSelection:this.updateSelection}),this.kfEditor.registerService("syntax.get.record.cursor",this,{getCursorRecord:this.getCursorRecord}),this.kfEditor.registerService("syntax.has.cursor.info",this,{hasCursorInfo:this.hasCursorInfo}),this.kfEditor.registerService("syntax.serialization",this,{serialization:this.serialization}),this.kfEditor.registerService("syntax.cursor.move.left",this,{leftMove:this.leftMove}),this.kfEditor.registerService("syntax.cursor.move.right",this,{rightMove:this.rightMove}),this.kfEditor.registerService("syntax.delete.group",this,{deleteGroup:this.deleteGroup})},initCommands:function(){this.kfEditor.registerCommand("get.source",this,this.getSource),this.kfEditor.registerCommand("content.is.empty",this,this.isEmpty)},updateObjTree:function(t){var e=t.select;e&&e.groupId&&this.updateCursor(e.groupId,e.startOffset,e.endOffset),this.objTree=t},hasCursorInfo:function(){return null!==this.record.cursor.group},isRootNode:function(t){return this.objTree.mapping.root.strGroup.attr.id===t},isGroupNode:function(t){var e=this.objTree.mapping[t].strGroup.attr["data-type"];return e===o.GROUP||e===o.VIRTUAL},isVirtualNode:function(t){return this.objTree.mapping[t].strGroup.attr["data-type"]===o.VIRTUAL},isPlaceholder:function(t){var e=this.objTree.mapping[t];return e?(e=e.objGroup.node,"Placeholder"===e.getAttribute("data-flag")):!1},isBrackets:function(t){return!!this.objTree.mapping[t].objGroup.node.getAttribute("data-brackets")},hasRootplaceholder:function(){return"placeholder"===this.objTree.mapping.root.strGroup.operand[0].name},isSelectPlaceholder:function(){var t=this.record.cursor,e=null;return t.endOffset-t.startOffset!==1?!1:(e=this.getGroupContent(t.groupId),this.isPlaceholder(e.content[t.startOffset].id)?!0:!1)},isLeafTree:function(t){return"string"==typeof t},isRootTree:function(t){return t.attr&&t.attr["data-root"]},getObjectTree:function(){return this.objTree},getGroupObject:function(t){return this.objTree.mapping[t].objGroup||null},getCursorRecord:function(){return t.Utils.extend({},this.record.cursor)||null},getGroupContent:function(e){var r=this.objTree.mapping[e],i=[],n=r.objGroup.operands,o=n.length-1,s="rtl"!==r.strGroup.traversal;return t.Utils.each(n,function(t,e){s?i.push(t.node):i[o-e]=t.node}),{id:e,traversal:r.strGroup.traversal||"ltr",groupObj:r.objGroup.node,content:i}},getRootObject:function(){return this.objTree.mapping.root.objGroup},getRootGroupInfo:function(){var t=this.objTree.mapping.root.strGroup.attr.id;return this.getGroupContent(t)},updateSelection:function(t){var e=this.objTree.mapping[t.id],r=e.strGroup,i=null,o=null,s=null,a=-1,l=-1;if(i=t,o=e,"combination"===r.name)this.record.cursor={groupId:i.id,startOffset:0,endOffset:r.operand.length},r.operand.unshift(n),r.operand.push(n);else{for(;"combination"!==o.strGroup.name||1===i.content;)t=i,e=o,i=this.kfEditor.requestService("position.get.parent.group",e.objGroup.node),o=this.objTree.mapping[i.id];var h=[].indexOf.call(i.content,t.groupObj);this.record.cursor={groupId:i.id,startOffset:h,endOffset:h+1},o.strGroup.operand.splice(h+1,0,n),o.strGroup.operand.splice(h,0,n)}return s=this.kfEditor.requestService("parser.latex.serialization",this.objTree.parsedTree),a=s.indexOf(n),s=s.replace(n,""),l=s.indexOf(n),o.strGroup.operand.splice(this.record.cursor.startOffset,1),o.strGroup.operand.splice(this.record.cursor.endOffset,1),{str:s,startOffset:a,endOffset:l}},getSource:function(){return this.serialization().str.replace(n,"").replace(n,"")},isEmpty:function(){return this.hasRootplaceholder()},serialization:function(){var t=this.record.cursor,e=this.objTree.mapping[t.groupId],r=e.strGroup,i=null,o=-1,s=-1;return o=Math.min(t.endOffset,t.startOffset),s=Math.max(t.endOffset,t.startOffset),r.operand.splice(s,0,n),r.operand.splice(o,0,n),s+=1,i=this.kfEditor.requestService("parser.latex.serialization",this.objTree.parsedTree),r.operand.splice(s,1),r.operand.splice(o,1),o=i.indexOf(n),t.startOffset===t.endOffset&&(i=i.replace(n,"")),s=i.lastIndexOf(n),{str:i,startOffset:o,endOffset:s}},updateCursor:function(t,e,r){var i=null;1===arguments.length&&(r=t.endOffset,e=t.startOffset,t=t.groupId),void 0===r&&(r=e),e>r&&(i=r,r=e,e=i),this.record.cursor={groupId:t,startOffset:e,endOffset:r}},leftMove:function(){this.components.move.leftMove()},rightMove:function(){this.components.move.rightMove()},deleteGroup:function(){return this.components.delete.deleteGroup()},insertSubtree:function(t){var e=this.record.cursor,r=0,i=0,n=null,o=0;this.isPlaceholder(e.groupId)?this.replaceTree(t):(r=Math.min(e.startOffset,e.endOffset),i=Math.max(e.startOffset,e.endOffset),o=i-r,n=this.objTree.mapping[e.groupId].strGroup,n.operand.splice(r,o,t),e.startOffset+=1,e.endOffset=e.startOffset)},replaceTree:function(t){var e=this.record.cursor,r=this.objTree.mapping[e.groupId].objGroup.node,i=this.kfEditor.requestService("position.get.parent.info",r),n=this.objTree.mapping[i.group.id].strGroup;n.operand[i.index]=t,e.groupId=i.group.id,e.startOffset=i.index+1,e.endOffset=i.index+1}});return s}},e[29]={value:function(){return{cursorCharacter:"",rootPlaceholder:{color:"#666",content:"在此处键入公式",fontsize:16},scrollbar:{padding:5,step:150}}}},e[30]={value:function(){return{"\\pm":{x:5,y:0},"\\infty":{x:42,y:0},"=":{x:79,y:0},"\\sim":{x:116,y:0},"\\times":{x:153,y:0},"\\div":{x:190,y:0},"!":{x:227,y:0},"<":{x:264,y:0},"\\ll":{x:301,y:0},">":{x:338,y:0},"\\gg":{x:375,y:0},"\\leq":{x:412,y:0},"\\geq":{x:449,y:0},"\\mp":{x:486,y:0},"\\cong":{x:523,y:0},"\\equiv":{x:560,y:0},"\\propto":{x:597,y:0},"\\approx":{x:634,y:0},"\\forall":{x:671,y:0},"\\partial":{x:708,y:0},"\\surd":{x:745,y:0},"\\cup":{x:782,y:0},"\\cap":{x:819,y:0},"\\varnothing":{x:856,y:0},"%":{x:893,y:0},"\\circ":{x:930,y:0},"\\exists":{x:967,y:0},"\\nexists":{x:1004,y:0},"\\in":{x:1041,y:0},"\\ni":{x:1078,y:0},"\\gets":{x:5,y:37},"\\uparrow":{x:42,y:37},"\\to":{x:79,y:37},"\\downarrow":{x:116,y:37},"\\leftrightarrow":{x:153,y:37},"\\therefore":{x:190,y:37},"\\because":{x:227,y:37},"+":{x:264,y:37},"-":{x:301,y:37},"\\neg":{x:338,y:37},"\\ast":{x:375,y:37},"\\cdot":{x:412,y:37},"\\vdots":{x:449,y:37},"\\ddots":{x:486,y:37},"\\aleph":{x:523,y:37},"\\beth":{x:560,y:37},"\\blacksquare":{x:597,y:37},"\\alpha":{x:634,y:37},"\\beta":{x:671,y:37},"\\gamma":{x:708,y:37},"\\delta":{x:745,y:37},"\\epsilon":{x:782,y:37},"\\zeta":{x:819,y:37},"\\eta":{x:856,y:37},"\\theta":{x:893,y:37},"\\iota":{x:930,y:37},"\\kappa":{x:967,y:37},"\\lambda":{x:1004,y:37},"\\mu":{x:1041,y:37},"\\nu":{x:1078,y:37},"\\xi":{x:5,y:74},"\\omicron":{x:42,y:74},"\\pi":{x:79,y:74},"\\rho":{x:116,y:74},"\\sigma":{x:153,y:74},"\\tau":{x:190,y:74},"\\upsilon":{x:227,y:74},"\\phi":{x:264,y:74},"\\chi":{x:301,y:74},"\\psi":{x:338,y:74},"\\omega":{x:375,y:74},"\\Alpha":{x:412,y:74},"\\Beta":{x:449,y:74},"\\Gamma":{x:486,y:74},"\\Delta":{x:523,y:74},"\\Epsilon":{x:560,y:74},"\\Zeta":{x:597,y:74},"\\Eta":{x:634,y:74},"\\Theta":{x:671,y:74},"\\Iota":{x:708,y:74},"\\Kappa":{x:745,y:74},"\\Lambda":{x:782,y:74},"\\Mu":{x:819,y:74},"\\Nu":{x:856,y:74},"\\Xi":{x:893,y:74},"\\Omicron":{x:930,y:74},"\\Pi":{x:967,y:74},"\\Rho":{x:1004,y:74},"\\Sigma":{x:1041,y:74},"\\Tau":{x:1078,y:74},"\\Upsilon":{x:5,y:111},"\\Phi":{x:42,y:111},"\\Chi":{x:79,y:111},"\\Psi":{x:116,y:111},"\\Omega":{x:153,y:111},"\\digamma":{x:190,y:111},"\\varepsilon":{x:227,y:111},"\\varkappa":{x:264,y:111},"\\varphi":{x:301,y:111},"\\varpi":{x:338,y:111},"\\varrho":{x:375,y:111},"\\varsigma":{x:412,y:111},"\\vartheta":{x:449,y:111},"\\neq":{x:486,y:111},"\\nless":{x:523,y:111},"\\ngtr":{x:560,y:111},"\\nleq":{x:597,y:111},"\\ngeq":{x:634,y:111},"\\nsim":{x:671,y:111},"\\lneqq":{x:708,y:111},"\\gneqq":{x:745,y:111},"\\nprec":{x:782,y:111},"\\nsucc":{x:819,y:111},"\\notin":{x:856,y:111},"\\nsubseteq":{x:893,y:111},"\\nsupseteq":{x:930,y:111},"\\subsetneq":{x:967,y:111},"\\supsetneq":{x:1004,y:111},"\\lnsim":{x:1041,y:111},"\\gnsim":{x:1078,y:111},"\\precnsim":{x:5,y:148},"\\succnsim":{x:42,y:148},"\\ntriangleleft":{x:79,y:148},"\\ntriangleright":{x:116,y:148},"\\ntrianglelefteq":{x:153,y:148},"\\ntrianglerighteq":{x:190,y:148},"\\nmid":{x:227,y:148},"\\nparallel":{x:264,y:148},"\\nvdash":{x:301,y:148},"\\nVdash":{x:338,y:148},"\\nvDash":{x:375,y:148},"\\nVDash":{x:412,y:148},"\\daleth":{x:449,y:148},"\\gimel":{x:486,y:148},"\\complement":{x:523,y:148},"\\ell":{x:560,y:148},"\\eth":{x:597,y:148},"\\hbar":{x:634,y:148},"\\hslash":{x:671,y:148},"\\mho":{x:708,y:148},"\\wp":{x:745,y:148},"\\circledS":{x:782,y:148},"\\Bbbk":{x:819,y:148},"\\Finv":{x:856,y:148},"\\Game":{x:893,y:148},"\\Im":{x:930,y:148},"\\Re":{x:967,y:148},"\\updownarrow":{x:1004,y:148},"\\Leftarrow":{x:1041,y:148},"\\Rightarrow":{x:1078,y:148},"\\Uparrow":{x:5,y:185},"\\Downarrow":{x:42,y:185},"\\Leftrightarrow":{x:79,y:185},"\\Updownarrow":{x:116,y:185},"\\longleftarrow":{x:153,y:185},"\\longrightarrow":{x:190,y:185},"\\longleftrightarrow":{x:227,y:185},"\\Longleftarrow":{x:264,y:185},"\\Longrightarrow":{x:301,y:185},"\\Longleftrightarrow":{x:338,y:185},"\\nearrow":{x:375,y:185},"\\nwarrow":{x:412,y:185},"\\searrow":{x:449,y:185},"\\swarrow":{x:486,y:185},"\\nleftarrow":{x:523,y:185},"\\nrightarrow":{x:560,y:185},"\\nLeftarrow":{x:597,y:185},"\\nRightarrow":{x:634,y:185},"\\nLeftrightarrow":{x:671,y:185},"\\leftharpoonup":{x:708,y:185},"\\leftharpoondown":{x:745,y:185},"\\rightharpoonup":{x:782,y:185},"\\rightharpoondown":{x:819,y:185},"\\upharpoonleft":{x:856,y:185},"\\upharpoonright":{x:893,y:185},"\\downharpoonleft":{x:930,y:185},"\\downharpoonright":{x:967,y:185},"\\leftrightharpoons":{x:1004,y:185},"\\rightleftharpoons":{x:1041,y:185},"\\leftleftarrows":{x:1078,y:185},"\\rightrightarrows":{x:5,y:222},"\\upuparrows":{x:42,y:222},"\\downdownarrows":{x:79,y:222},"\\leftrightarrows":{x:116,y:222},"\\rightleftarrows":{x:153,y:222},"\\looparrowleft":{x:190,y:222},"\\looparrowright":{x:227,y:222},"\\leftarrowtail":{x:264,y:222},"\\rightarrowtail":{x:301,y:222},"\\Lsh":{x:338,y:222},"\\Rsh":{x:375,y:222},"\\Lleftarrow":{x:412,y:222},"\\Rrightarrow":{x:449,y:222},"\\curvearrowleft":{x:486,y:222},"\\curvearrowright":{x:523,y:222},"\\circlearrowleft":{x:560,y:222},"\\circlearrowright":{x:597,y:222},"\\multimap":{x:634,y:222},"\\leftrightsquigarrow":{x:671,y:222},"\\twoheadleftarrow":{x:708,y:222},"\\twoheadrightarrow":{x:745,y:222},"\\rightsquigarrow":{x:782,y:222},"\\mathcal{A}":{x:819,y:222},"\\mathcal{B}":{x:856,y:222},"\\mathcal{C}":{x:893,y:222},"\\mathcal{D}":{x:930,y:222},"\\mathcal{E}":{x:967,y:222},"\\mathcal{F}":{x:1004,y:222},"\\mathcal{G}":{x:1041,y:222},"\\mathcal{H}":{x:1078,y:222},"\\mathcal{I}":{x:5,y:259},"\\mathcal{J}":{x:42,y:259},"\\mathcal{K}":{x:79,y:259},"\\mathcal{L}":{x:116,y:259},"\\mathcal{M}":{x:153,y:259},"\\mathcal{N}":{x:190,y:259},"\\mathcal{O}":{x:227,y:259},"\\mathcal{P}":{x:264,y:259},"\\mathcal{Q}":{x:301,y:259},"\\mathcal{R}":{x:338,y:259},"\\mathcal{S}":{x:375,y:259},"\\mathcal{T}":{x:412,y:259},"\\mathcal{U}":{x:449,y:259},"\\mathcal{V}":{x:486,y:259},"\\mathcal{W}":{x:523,y:259},"\\mathcal{X}":{x:560,y:259},"\\mathcal{Y}":{x:597,y:259},"\\mathcal{Z}":{x:634,y:259},"\\mathfrak{A}":{x:671,y:259},"\\mathfrak{B}":{x:708,y:259},"\\mathfrak{C}":{x:745,y:259},"\\mathfrak{D}":{x:782,y:259},"\\mathfrak{E}":{x:819,y:259},"\\mathfrak{F}":{x:856,y:259},"\\mathfrak{G}":{x:893,y:259},"\\mathfrak{H}":{x:930,y:259},"\\mathfrak{I}":{x:967,y:259},"\\mathfrak{J}":{x:1004,y:259},"\\mathfrak{K}":{x:1041,y:259},"\\mathfrak{L}":{x:1078,y:259},"\\mathfrak{M}":{x:5,y:296},"\\mathfrak{N}":{x:42,y:296},"\\mathfrak{O}":{x:79,y:296},"\\mathfrak{P}":{x:116,y:296},"\\mathfrak{Q}":{x:153,y:296},"\\mathfrak{R}":{x:190,y:296},"\\mathfrak{S}":{x:227,y:296},"\\mathfrak{T}":{x:264,y:296},"\\mathfrak{U}":{x:301,y:296},"\\mathfrak{V}":{x:338,y:296},"\\mathfrak{W}":{x:375,y:296},"\\mathfrak{X}":{x:412,y:296},"\\mathfrak{Y}":{x:449,y:296},"\\mathfrak{Z}":{x:486,y:296},"\\mathfrak{a}":{x:523,y:296},"\\mathfrak{b}":{x:560,y:296},"\\mathfrak{c}":{x:597,y:296},"\\mathfrak{d}":{x:634,y:296},"\\mathfrak{e}":{x:671,y:296},"\\mathfrak{f}":{x:708,y:296},"\\mathfrak{g}":{x:745,y:296},"\\mathfrak{h}":{x:782,y:296},"\\mathfrak{i}":{x:819,y:296},"\\mathfrak{j}":{x:856,y:296},"\\mathfrak{k}":{x:893,y:296},"\\mathfrak{l}":{x:930,y:296},"\\mathfrak{m}":{x:967,y:296},"\\mathfrak{n}":{x:1004,y:296},"\\mathfrak{o}":{x:1041,y:296},"\\mathfrak{p}":{x:1078,y:296},"\\mathfrak{q}":{x:5,y:333},"\\mathfrak{r}":{x:42,y:333},"\\mathfrak{s}":{x:79,y:333},"\\mathfrak{t}":{x:116,y:333},"\\mathfrak{u}":{x:153,y:333},"\\mathfrak{v}":{x:190,y:333},"\\mathfrak{w}":{x:227,y:333},"\\mathfrak{x}":{x:264,y:333},"\\mathfrak{y}":{x:301,y:333},"\\mathfrak{z}":{x:338,y:333},"\\mathbb{A}":{x:375,y:333},"\\mathbb{B}":{x:412,y:333},"\\mathbb{C}":{x:449,y:333},"\\mathbb{D}":{x:486,y:333},"\\mathbb{E}":{x:523,y:333},"\\mathbb{F}":{x:560,y:333},"\\mathbb{G}":{x:597,y:333},"\\mathbb{H}":{x:634,y:333},"\\mathbb{I}":{x:671,y:333},"\\mathbb{J}":{x:708,y:333},"\\mathbb{K}":{x:745,y:333},"\\mathbb{L}":{x:782,y:333},"\\mathbb{M}":{x:819,y:333},"\\mathbb{N}":{x:856,y:333},"\\mathbb{O}":{x:893,y:333},"\\mathbb{P}":{x:930,y:333},"\\mathbb{Q}":{x:967,y:333},"\\mathbb{R}":{x:1004,y:333},"\\mathbb{S}":{x:1041,y:333},"\\mathbb{T}":{x:1078,y:333},"\\mathbb{U}":{x:5,y:370},"\\mathbb{V}":{x:42,y:370},"\\mathbb{W}":{x:79,y:370},"\\mathbb{X}":{x:116,y:370},"\\mathbb{Y}":{x:153,y:370},"\\mathbb{Z}":{x:190,y:370},"\\mathrm{A}":{x:227,y:370},"\\mathrm{B}":{x:264,y:370},"\\mathrm{C}":{x:301,y:370},"\\mathrm{D}":{x:338,y:370},"\\mathrm{E}":{x:375,y:370},"\\mathrm{F}":{x:412,y:370},"\\mathrm{G}":{x:449,y:370},"\\mathrm{H}":{x:486,y:370},"\\mathrm{I}":{x:523,y:370},"\\mathrm{J}":{x:560,y:370},"\\mathrm{K}":{x:597,y:370},"\\mathrm{L}":{x:634,y:370},"\\mathrm{M}":{x:671,y:370},"\\mathrm{N}":{x:708,y:370},"\\mathrm{O}":{x:745,y:370},"\\mathrm{P}":{x:782,y:370},"\\mathrm{Q}":{x:819,y:370},"\\mathrm{R}":{x:856,y:370},"\\mathrm{S}":{x:893,y:370},"\\mathrm{T}":{x:930,y:370},"\\mathrm{U}":{x:967,y:370},"\\mathrm{V}":{x:1004,y:370},"\\mathrm{W}":{x:1041,y:370},"\\mathrm{X}":{x:1078,y:370},"\\mathrm{Y}":{x:5,y:407},"\\mathrm{Z}":{x:42,y:407},"\\mathrm{a}":{x:79,y:407},"\\mathrm{b}":{x:116,y:407},"\\mathrm{c}":{x:153,y:407},"\\mathrm{d}":{x:190,y:407},"\\mathrm{e}":{x:227,y:407},"\\mathrm{f}":{x:264,y:407},"\\mathrm{g}":{x:301,y:407},"\\mathrm{h}":{x:338,y:407},"\\mathrm{i}":{x:375,y:407},"\\mathrm{j}":{x:412,y:407},"\\mathrm{k}":{x:449,y:407},"\\mathrm{l}":{x:486,y:407},"\\mathrm{m}":{x:523,y:407},"\\mathrm{n}":{x:560,y:407},"\\mathrm{o}":{x:597,y:407},"\\mathrm{p}":{x:634,y:407},"\\mathrm{q}":{x:671,y:407},"\\mathrm{r}":{x:708,y:407},"\\mathrm{s}":{x:745,y:407},"\\mathrm{t}":{x:782,y:407},"\\mathrm{u}":{x:819,y:407},"\\mathrm{v}":{x:856,y:407},"\\mathrm{w}":{x:893,y:407},"\\mathrm{x}":{x:930,y:407},"\\mathrm{y}":{x:967,y:407},"\\mathrm{z}":{x:1004,y:407}}}},e[31]={value:function(){var t=e.r(4),r=e.r(20),i={min:1,max:2},n=r.createClass("ScrollZoomController",{constructor:function(e,r,n,o){this.kfEditor=r,this.target=n,this.zoom=1,this.step=.05,this.options=t.extend({},i,o),this.initEvent()},initEvent:function(){var e=this.kfEditor,r=this,i=this.options.min,n=this.options.max,o=this.step;t.addEvent(this.target,"mousewheel",function(t){t.preventDefault(),t.wheelDelta<0?r.zoom-=r.zoom*o:r.zoom+=r.zoom*o,r.zoom=Math.max(r.zoom,i),r.zoom=Math.min(r.zoom,n),e.requestService("render.set.canvas.zoom",r.zoom)})}});return n}},e[32]={value:function(){return{VIEW_STATE:{NO_OVERFLOW:0,OVERFLOW:1},scrollbar:{step:50,thumbMinSize:50}}}},e[33]={value:function(){return{"x=\\frac {-b\\pm\\sqrt {b^2-4ac}}{2a}":{pos:{x:0,y:0},size:{width:310,height:73}},"{\\placeholder/\\placeholder}":{pos:{x:315,y:0},size:{width:56,height:75}},"\\frac \\placeholder\\placeholder":{pos:{x:376,y:0},size:{width:56,height:75}},"a^2+b^2=c^2":{pos:{x:437,y:0},size:{width:310,height:73}},"{\\left(x+a\\right)}^2=\\sum^n_{k=0}{\\left(^n_k\\right)x^ka^{n-k}}":{pos:{x:752,y:0},size:{width:310,height:73}},"\\frac {dy}{dx}":{pos:{x:1067,y:0},size:{width:56,height:75}},"\\frac {\\Delta y}{\\Delta x}":{pos:{x:1128,y:0},size:{width:56,height:75}},"\\frac {\\delta y}{\\delta x}":{pos:{x:1189,y:0},size:{width:56,height:75}},"\\frac \\pi 2":{pos:{x:1250,y:0},size:{width:56,height:75}},"\\placeholder^\\placeholder":{pos:{x:1311,y:0},size:{width:56,height:75}},"\\placeholder^\\placeholder_\\placeholder":{pos:{x:1372,y:0},size:{width:56,height:75}},"\\placeholder_\\placeholder":{pos:{x:1433,y:0},size:{width:56,height:75}},"{^\\placeholder_\\placeholder\\placeholder}":{pos:{x:1494,y:0},size:{width:56,height:75}},"e^{-i\\omega t}":{pos:{x:1555,y:0},size:{width:56,height:75}},"x^2":{pos:{x:1616,y:0},size:{width:56,height:75}},"{}^n_1Y":{pos:{x:1677,y:0},size:{width:56,height:75}},"\\sqrt \\placeholder":{pos:{x:1738,y:0},size:{width:56,height:75}},"\\sqrt [\\placeholder] \\placeholder":{pos:{x:1799,y:0},size:{width:56,height:75}},"\\sqrt [2] \\placeholder":{pos:{x:1860,y:0},size:{width:56,height:75}},"\\sqrt [3] \\placeholder":{pos:{x:1921,y:0},size:{width:56,height:75}},"\\frac {-b\\pm\\sqrt{b^2-4ac}}{2a}":{pos:{x:1982,y:0},size:{width:137,height:75}},"\\sqrt {a^2+b^2}":{pos:{x:2124,y:0},size:{width:137,height:75}},"\\int \\placeholder":{pos:{x:2266,y:0},size:{width:56,height:75}},"\\int^\\placeholder_\\placeholder\\placeholder":{pos:{x:2327,y:0},size:{width:56,height:75}},"\\iint\\placeholder":{pos:{x:2388,y:0},size:{width:56,height:75}},"\\iint^\\placeholder_\\placeholder\\placeholder":{pos:{x:2449,y:0},size:{width:56,height:75}},"\\iiint\\placeholder":{pos:{x:2510,y:0},size:{width:56,height:75}},"\\iiint^\\placeholder_\\placeholder\\placeholder":{pos:{x:2571,y:0},size:{width:56,height:75}},"\\sum\\placeholder":{pos:{x:2632,y:0},size:{width:56,height:75}},"\\sum^\\placeholder_\\placeholder\\placeholder":{pos:{x:2693,y:0},size:{width:56,height:75}},"\\sum_\\placeholder\\placeholder":{pos:{x:2754,y:0},size:{width:56,height:75}},"\\left(\\placeholder\\right)":{pos:{x:2815,y:0},size:{width:56,height:75}},"\\left[\\placeholder\\right]":{pos:{x:2876,y:0},size:{width:56,height:75}},"\\left\\{\\placeholder\\right\\}":{pos:{x:2937,y:0},size:{width:56,height:75}},"\\left|\\placeholder\\right|":{pos:{x:2998,y:0},size:{width:56,height:75}},"\\sin\\placeholder":{pos:{x:3059,y:0},size:{width:56,height:75}},"\\cos\\placeholder":{pos:{x:3120,y:0},size:{width:56,height:75}},"\\tan\\placeholder":{pos:{x:3181,y:0},size:{width:56,height:75}},"\\csc\\placeholder":{pos:{x:3242,y:0},size:{width:56,height:75}},"\\sec\\placeholder":{pos:{x:3303,y:0},size:{width:56,height:75}},"\\cot\\placeholder":{pos:{x:3364,y:0},size:{width:56,height:75}},"\\sin\\theta":{pos:{x:3425,y:0},size:{width:56,height:75}},"\\cos{2x}":{pos:{x:3486,y:0},size:{width:56,height:75}},"\\tan\\theta=\\frac {\\sin\\theta}{\\cos\\theta}":{pos:{x:3547,y:0},size:{width:137,height:75}}}}},e[34]={value:function(){function t(t){var e=[],r=t.path,i=t.values;return n.Utils.each(i,function(t){var i=t,n=t;"string"!=typeof t?(i=t.img,n=t.key):n="\\"+t,e.push({item:{show:""+r+i.toLowerCase()+".png",val:n}})}),e}var r=e.r(41),i=e.r(40),n=e.r(20),o=[{type:r.DRAPDOWN_BOX,options:{button:{label:"预设<br/>",className:"yushe-btn",icon:"assets/images/toolbar/button/fx.png",iconSize:{w:40}},box:{width:367,group:[{title:"预设公式",items:[{title:"预设公式",content:[{label:"二次公式",item:{show:"assets/images/toolbar/ys/1.png",val:"x=\\frac {-b\\pm\\sqrt {b^2-4ac}}{2a}"}},{label:"二项式定理",item:{show:"assets/images/toolbar/ys/2.png",val:"{\\left(x+a\\right)}^2=\\sum^n_{k=0}{\\left(^n_k\\right)x^ka^{n-k}}"}},{label:"勾股定理",item:{show:"assets/images/toolbar/ys/3.png",val:"a^2+b^2=c^2"}}]}]}]}}},{type:r.DELIMITER},{type:r.AREA,options:{box:{fixOffset:!0,width:527,type:i.OVERLAP,group:[{title:"基础数学",items:[]},{title:"希腊字母",items:[]},{title:"求反关系运算符",items:[]},{title:"字母类符号",items:[]},{title:"箭头",items:[]},{title:"手写体",items:[]}]}}},{type:r.DELIMITER},{type:r.DRAPDOWN_BOX,options:{button:{label:"分数<br/>",icon:"assets/images/toolbar/button/frac.png"},box:{width:332,group:[{title:"分数",items:[{title:"分数",content:[{item:{show:"assets/images/toolbar/frac/1.png",val:"\\frac \\placeholder\\placeholder"}},{item:{show:"assets/images/toolbar/frac/2.png",val:"{\\placeholder/\\placeholder}"}}]},{title:"常用分数",content:[{item:{show:"assets/images/toolbar/frac/c1.png",val:"\\frac {dy}{dx}"}},{item:{show:"assets/images/toolbar/frac/c2.png",val:"\\frac {\\Delta y}{\\Delta x}"}},{item:{show:"assets/images/toolbar/frac/c4.png",val:"\\frac {\\delta y}{\\delta x}"}},{item:{show:"assets/images/toolbar/frac/c5.png",val:"\\frac \\pi 2"}}]}]}]}}},{type:r.DRAPDOWN_BOX,options:{button:{label:"上下标<br/>",icon:"assets/images/toolbar/button/script.png"},box:{width:332,group:[{title:"上标和下标",items:[{title:"上标和下标",content:[{item:{show:"assets/images/toolbar/script/1.png",val:"\\placeholder^\\placeholder"}},{item:{show:"assets/images/toolbar/script/2.png",val:"\\placeholder_\\placeholder"}},{item:{show:"assets/images/toolbar/script/3.png",val:"\\placeholder^\\placeholder_\\placeholder"}},{item:{show:"assets/images/toolbar/script/4.png",val:"{^\\placeholder_\\placeholder\\placeholder}"}}]},{title:"常用的上标和下标",content:[{item:{show:"assets/images/toolbar/script/c1.png",val:"e^{-i\\omega t}"}},{item:{show:"assets/images/toolbar/script/c2.png",val:"x^2"}},{item:{show:"assets/images/toolbar/script/c3.png",val:"{}^n_1Y"}}]}]}]}}},{type:r.DRAPDOWN_BOX,options:{button:{label:"根式<br/>",icon:"assets/images/toolbar/button/sqrt.png"},box:{width:342,group:[{title:"根式",items:[{title:"根式",content:[{item:{show:"assets/images/toolbar/sqrt/1.png",val:"\\sqrt \\placeholder"}},{item:{show:"assets/images/toolbar/sqrt/2.png",val:"\\sqrt [\\placeholder] \\placeholder"}},{item:{show:"assets/images/toolbar/sqrt/3.png",val:"\\sqrt [2] \\placeholder"}},{item:{show:"assets/images/toolbar/sqrt/4.png",val:"\\sqrt [3] \\placeholder"}}]},{title:"常用根式",content:[{item:{show:"assets/images/toolbar/sqrt/c1.png",val:"\\frac {-b\\pm\\sqrt{b^2-4ac}}{2a}"}},{item:{show:"assets/images/toolbar/sqrt/c2.png",val:"\\sqrt {a^2+b^2}"}}]}]}]}}},{type:r.DRAPDOWN_BOX,options:{button:{label:"积分<br/>",icon:"assets/images/toolbar/button/int.png"},box:{width:332,group:[{title:"积分",items:[{title:"积分",content:[{item:{show:"assets/images/toolbar/int/1.png",val:"\\int \\placeholder"}},{item:{show:"assets/images/toolbar/int/2.png",val:"\\int^\\placeholder_\\placeholder\\placeholder"}},{item:{show:"assets/images/toolbar/int/3.png",val:"\\iint\\placeholder"}},{item:{show:"assets/images/toolbar/int/4.png",val:"\\iint^\\placeholder_\\placeholder\\placeholder"}},{item:{show:"assets/images/toolbar/int/5.png",val:"\\iiint\\placeholder"}},{item:{show:"assets/images/toolbar/int/6.png",val:"\\iiint^\\placeholder_\\placeholder\\placeholder"}}]}]}]}}},{type:r.DRAPDOWN_BOX,options:{button:{label:"大型<br/>运算符",icon:"assets/images/toolbar/button/sum.png"},box:{width:332,group:[{title:"求和",items:[{title:"求和",content:[{item:{show:"assets/images/toolbar/large/1.png",val:"\\sum\\placeholder"}},{item:{show:"assets/images/toolbar/large/2.png",val:"\\sum^\\placeholder_\\placeholder\\placeholder"}},{item:{show:"assets/images/toolbar/large/3.png",val:"\\sum_\\placeholder\\placeholder"}}]}]}]}}},{type:r.DRAPDOWN_BOX,options:{button:{label:"括号<br/>",icon:"assets/images/toolbar/button/brackets.png"},box:{width:332,group:[{title:"方括号",items:[{title:"方括号",content:[{item:{show:"assets/images/toolbar/brackets/1.png",val:"\\left(\\placeholder\\right)"}},{item:{show:"assets/images/toolbar/brackets/2.png",val:"\\left[\\placeholder\\right]"}},{item:{show:"assets/images/toolbar/brackets/3.png",val:"\\left\\{\\placeholder\\right\\}"}},{item:{show:"assets/images/toolbar/brackets/4.png",val:"\\left|\\placeholder\\right|"}}]}]}]}}},{type:r.DRAPDOWN_BOX,options:{button:{label:"函数<br/>",icon:"assets/images/toolbar/button/sin.png"},box:{width:340,group:[{title:"函数",items:[{title:"三角函数",content:[{item:{show:"assets/images/toolbar/func/1.png",val:"\\sin\\placeholder"}},{item:{show:"assets/images/toolbar/func/2.png",val:"\\cos\\placeholder"}},{item:{show:"assets/images/toolbar/func/3.png",val:"\\tan\\placeholder"}},{item:{show:"assets/images/toolbar/func/4.png",val:"\\csc\\placeholder"}},{item:{show:"assets/images/toolbar/func/5.png",val:"\\sec\\placeholder"}},{item:{show:"assets/images/toolbar/func/6.png",val:"\\cot\\placeholder"}}]},{title:"常用函数",content:[{item:{show:"assets/images/toolbar/func/c1.png",val:"\\sin\\theta"}},{item:{show:"assets/images/toolbar/func/c2.png",val:"\\sin{2x}"}},{item:{show:"assets/images/toolbar/func/c3.png",val:"\\tan\\theta=\\frac {\\sin\\theta}{\\cos\\theta}"}}]}]}]}}}];
return function(){var e=["pm","infty",{key:"=",img:"eq"},"sim","times","div",{key:"!",img:"tanhao"},{key:"<",img:"lt"},"ll",{key:">",img:"gt"},"gg","leq","geq","mp","cong","equiv","propto","approx","forall","partial","surd","cup","cap","varnothing",{key:"%",img:"baifenhao"},"circ","exists","nexists","in","ni","gets","uparrow","to","downarrow","leftrightarrow","therefore","because",{key:"+",img:"plus"},{key:"-",img:"minus"},"neg","ast","cdot","vdots","ddots","aleph","beth","blacksquare"],r=o[2].options.box.group[0].items;r.push({title:"基础数学",content:t({path:"assets/images/toolbar/char/math/",values:e})})}(),function(){var e=[{title:"小写",values:["alpha","beta","gamma","delta","epsilon","zeta","eta","theta","iota","kappa","lambda","mu","nu","xi","omicron","pi","rho","sigma","tau","upsilon","phi","chi","psi","omega"]},{title:"大写",values:["Alpha","Beta","Gamma","Delta","Epsilon","Zeta","Eta","Theta","Iota","Kappa","Lambda","Mu","Nu","Xi","Omicron","Pi","Rho","Sigma","Tau","Upsilon","Phi","Chi","Psi","Omega"]},{title:"变体",values:["digamma","varepsilon","varkappa","varphi","varpi","varrho","varsigma","vartheta"]}],r=o[2].options.box.group[1].items;r.push({title:e[0].title,content:t({path:"assets/images/toolbar/char/greek/lower/",values:e[0].values})}),r.push({title:e[1].title,content:t({path:"assets/images/toolbar/char/greek/upper/",values:e[1].values})}),r.push({title:e[2].title,content:t({path:"assets/images/toolbar/char/greek/misc/",values:e[2].values})})}(),function(){var e=[{title:"求反关系运算符",values:["neq","nless","ngtr","nleq","ngeq","nsim","lneqq","gneqq","nprec","nsucc","notin","nsubseteq","nsupseteq","subsetneq","supsetneq","lnsim","gnsim","precnsim","succnsim","ntriangleleft","ntriangleright","ntrianglelefteq","ntrianglerighteq","nmid","nparallel","nvdash",{key:"\\nVdash",img:"nvdash-1"},{key:"\\nvDash",img:"nvdash-2"},{key:"\\nVDash",img:"nvdash-3"},"nexists"]}],r=o[2].options.box.group[2].items;r.push({title:e[0].title,content:t({path:"assets/images/toolbar/char/not/",values:e[0].values})})}(),function(){var e=["aleph","beth","daleth","gimel","complement","ell","eth","hbar","hslash","mho","partial","wp","circledS","Bbbk","Finv","Game","Im","Re"],r=o[2].options.box.group[3].items;r.push({title:"字母类符号",content:t({path:"assets/images/toolbar/alphabetic/",values:e})})}(),function(){var e=["gets","to","uparrow","downarrow","leftrightarrow","updownarrow",{key:"\\Leftarrow",img:"u-leftarrow"},{key:"\\Rightarrow",img:"u-rightarrow"},{key:"\\Uparrow",img:"u-uparrow"},{key:"\\Downarrow",img:"u-downarrow"},{key:"\\Leftrightarrow",img:"u-leftrightarrow"},{key:"\\Updownarrow",img:"u-updownarrow"},"longleftarrow","longrightarrow","longleftrightarrow",{key:"\\Longleftarrow",img:"u-longleftarrow"},{key:"\\Longrightarrow",img:"u-longrightarrow"},{key:"\\Longleftrightarrow",img:"u-longleftrightarrow"},"nearrow","nwarrow","searrow","swarrow","nleftarrow","nrightarrow",{key:"\\nLeftarrow",img:"u-nleftarrow"},{key:"\\nRightarrow",img:"u-nrightarrow"},{key:"\\nLeftrightarrow",img:"u-nleftrightarrow"},"leftharpoonup","leftharpoondown","rightharpoonup","rightharpoondown","upharpoonleft","upharpoonright","downharpoonleft","downharpoonright","leftrightharpoons","rightleftharpoons","leftleftarrows","rightrightarrows","upuparrows","downdownarrows","leftrightarrows","rightleftarrows","looparrowleft","looparrowright","leftarrowtail","rightarrowtail",{key:"\\Lsh",img:"u-lsh"},{key:"\\Rsh",img:"u-rsh"},{key:"\\Lleftarrow",img:"u-lleftarrow"},{key:"\\Rrightarrow",img:"u-rrightarrow"},"curvearrowleft","curvearrowright","circlearrowleft","circlearrowright","multimap","leftrightsquigarrow","twoheadleftarrow","twoheadrightarrow","rightsquigarrow"],r=o[2].options.box.group[4].items;r.push({title:"箭头",content:t({path:"assets/images/toolbar/arrow/",values:e})})}(),function(){var e=[{title:"手写体",values:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"]},{title:"花体",values:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"]},{title:"双线",values:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"]},{title:"罗马",values:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"]}],r=o[2].options.box.group[5].items;n.Utils.each(e[0].values,function(t,r){e[0].values[r]={key:"\\mathcal{"+t+"}",img:t.toLowerCase()}}),n.Utils.each(e[1].values,function(t,r){e[1].values[r]={key:"\\mathfrak{"+t+"}",img:t.replace(/[A-Z]/,function(t){return"u"+t.toLowerCase()})}}),n.Utils.each(e[2].values,function(t,r){e[2].values[r]={key:"\\mathbb{"+t+"}",img:t.toLowerCase()}}),n.Utils.each(e[3].values,function(t,r){e[3].values[r]={key:"\\mathrm{"+t+"}",img:t.replace(/[A-Z]/,function(t){return"u"+t.toLowerCase()})}}),r.push({title:e[0].title,content:t({path:"assets/images/toolbar/char/cal/",values:e[0].values})}),r.push({title:e[1].title,content:t({path:"assets/images/toolbar/char/frak/",values:e[1].values})}),r.push({title:e[2].title,content:t({path:"assets/images/toolbar/char/bb/",values:e[2].values})}),r.push({title:e[3].title,content:t({path:"assets/images/toolbar/char/rm/",values:e[3].values})})}(),window.iconConfig=o,o}},e[35]={value:function(){function t(t,e){var r=[];return s.Utils.each(t,function(t){t.length>1&&(t="\\"+t),r.push({key:t,img:e,pos:n[t]})}),r}var r=e.r(41),i=e.r(40),n=e.r(30),o=e.r(33),s=e.r(20),a=[{type:r.DRAPDOWN_BOX,options:{button:{label:"预设<br/>",className:"yushe-btn",icon:{src:"kityformula/assets/images/toolbar/btn.png",x:0,y:0},iconSize:{w:40}},box:{width:367,group:[{title:"预设公式",items:[{title:"预设公式",content:[{label:"二次公式",item:{val:"x=\\frac {-b\\pm\\sqrt {b^2-4ac}}{2a}"}},{label:"二项式定理",item:{val:"{\\left(x+a\\right)}^2=\\sum^n_{k=0}{\\left(^n_k\\right)x^ka^{n-k}}"}},{label:"勾股定理",item:{val:"a^2+b^2=c^2"}}]}]}]}}},{type:r.DELIMITER},{type:r.AREA,options:{box:{fixOffset:!0,width:527,type:i.OVERLAP,group:[{title:"基础数学",items:[]},{title:"希腊字母",items:[]},{title:"求反关系运算符",items:[]},{title:"字母类符号",items:[]},{title:"箭头",items:[]},{title:"手写体",items:[]}]}}},{type:r.DELIMITER},{type:r.DRAPDOWN_BOX,options:{button:{label:"分数<br/>",icon:{src:"kityformula/assets/images/toolbar/btn.png",x:45,y:0}},box:{width:332,group:[{title:"分数",items:[{title:"分数",content:[{item:{val:"\\frac \\placeholder\\placeholder"}},{item:{val:"{\\placeholder/\\placeholder}"}}]},{title:"常用分数",content:[{item:{val:"\\frac {dy}{dx}"}},{item:{val:"\\frac {\\Delta y}{\\Delta x}"}},{item:{val:"\\frac {\\delta y}{\\delta x}"}},{item:{val:"\\frac \\pi 2"}}]}]}]}}},{type:r.DRAPDOWN_BOX,options:{button:{label:"上下标<br/>",icon:{src:"kityformula/assets/images/toolbar/btn.png",x:82,y:0}},box:{width:332,group:[{title:"上标和下标",items:[{title:"上标和下标",content:[{item:{val:"\\placeholder^\\placeholder"}},{item:{val:"\\placeholder_\\placeholder"}},{item:{val:"\\placeholder^\\placeholder_\\placeholder"}},{item:{val:"{^\\placeholder_\\placeholder\\placeholder}"}}]},{title:"常用的上标和下标",content:[{item:{val:"e^{-i\\omega t}"}},{item:{val:"x^2"}},{item:{val:"{}^n_1Y"}}]}]}]}}},{type:r.DRAPDOWN_BOX,options:{button:{label:"根式<br/>",icon:{src:"kityformula/assets/images/toolbar/btn.png",x:119,y:0}},box:{width:342,group:[{title:"根式",items:[{title:"根式",content:[{item:{val:"\\sqrt \\placeholder"}},{item:{val:"\\sqrt [\\placeholder] \\placeholder"}},{item:{val:"\\sqrt [2] \\placeholder"}},{item:{val:"\\sqrt [3] \\placeholder"}}]},{title:"常用根式",content:[{item:{val:"\\frac {-b\\pm\\sqrt{b^2-4ac}}{2a}"}},{item:{val:"\\sqrt {a^2+b^2}"}}]}]}]}}},{type:r.DRAPDOWN_BOX,options:{button:{label:"积分<br/>",icon:{src:"kityformula/assets/images/toolbar/btn.png",x:156,y:0}},box:{width:332,group:[{title:"积分",items:[{title:"积分",content:[{item:{val:"\\int \\placeholder"}},{item:{val:"\\int^\\placeholder_\\placeholder\\placeholder"}},{item:{val:"\\iint\\placeholder"}},{item:{val:"\\iint^\\placeholder_\\placeholder\\placeholder"}},{item:{val:"\\iiint\\placeholder"}},{item:{val:"\\iiint^\\placeholder_\\placeholder\\placeholder"}}]}]}]}}},{type:r.DRAPDOWN_BOX,options:{button:{label:"大型<br/>运算符",icon:{src:"kityformula/assets/images/toolbar/btn.png",x:193,y:0}},box:{width:332,group:[{title:"求和",items:[{title:"求和",content:[{item:{val:"\\sum\\placeholder"}},{item:{val:"\\sum^\\placeholder_\\placeholder\\placeholder"}},{item:{val:"\\sum_\\placeholder\\placeholder"}}]}]}]}}},{type:r.DRAPDOWN_BOX,options:{button:{label:"括号<br/>",icon:{src:"kityformula/assets/images/toolbar/btn.png",x:230,y:0}},box:{width:332,group:[{title:"方括号",items:[{title:"方括号",content:[{item:{val:"\\left(\\placeholder\\right)"}},{item:{val:"\\left[\\placeholder\\right]"}},{item:{val:"\\left\\{\\placeholder\\right\\}"}},{item:{val:"\\left|\\placeholder\\right|"}}]}]}]}}},{type:r.DRAPDOWN_BOX,options:{button:{label:"函数<br/>",icon:{src:"kityformula/assets/images/toolbar/btn.png",x:267,y:0}},box:{width:340,group:[{title:"函数",items:[{title:"三角函数",content:[{item:{val:"\\sin\\placeholder"}},{item:{val:"\\cos\\placeholder"}},{item:{val:"\\tan\\placeholder"}},{item:{val:"\\csc\\placeholder"}},{item:{val:"\\sec\\placeholder"}},{item:{val:"\\cot\\placeholder"}}]},{title:"常用函数",content:[{item:{val:"\\sin\\theta"}},{item:{val:"\\cos{2x}"}},{item:{val:"\\tan\\theta=\\frac {\\sin\\theta}{\\cos\\theta}"}}]}]}]}}}];return function(){var t=[],e="kityformula/assets/images/toolbar/other.png",i=[];s.Utils.each(a,function(e){e.type!==r.DELIMITER&&(e=e.options.box.group,t=t.concat(e))}),s.Utils.each(t,function(t){t=t.items;for(var e=0,r=t.length;r>e;e++)i=i.concat(t[e].content)}),s.Utils.each(i,function(t){var r=o[t.item.val];r&&(t.item.img=e,t.item.pos=r.pos,t.item.size=r.size)})}(),function(){var e=["pm","infty","=","sim","times","div","!","<","ll",">","gg","leq","geq","mp","cong","equiv","propto","approx","forall","partial","surd","cup","cap","varnothing","%","circ","exists","nexists","in","ni","gets","uparrow","to","downarrow","leftrightarrow","therefore","because","+","-","neg","ast","cdot","vdots","aleph","beth","blacksquare"],r=a[2].options.box.group[0].items;r.push({title:"基础数学",content:t(e,"kityformula/assets/images/toolbar/char.png")})}(),function(){var e=[{title:"小写",values:["alpha","beta","gamma","delta","epsilon","zeta","eta","theta","iota","kappa","lambda","mu","nu","xi","omicron","pi","rho","sigma","tau","upsilon","phi","chi","psi","omega"]},{title:"大写",values:["Alpha","Beta","Gamma","Delta","Epsilon","Zeta","Eta","Theta","Iota","Kappa","Lambda","Mu","Nu","Xi","Omicron","Pi","Rho","Sigma","Tau","Upsilon","Phi","Chi","Psi","Omega"]},{title:"变体",values:["digamma","varepsilon","varkappa","varphi","varpi","varrho","varsigma","vartheta"]}],r=a[2].options.box.group[1].items;r.push({title:e[0].title,content:t(e[0].values,"kityformula/assets/images/toolbar/char.png")}),r.push({title:e[1].title,content:t(e[1].values,"kityformula/assets/images/toolbar/char.png")}),r.push({title:e[2].title,content:t(e[2].values,"kityformula/assets/images/toolbar/char.png")})}(),function(){var e=[{title:"求反关系运算符",values:["neq","nless","ngtr","nleq","ngeq","nsim","lneqq","gneqq","nprec","nsucc","notin","nsubseteq","nsupseteq","subsetneq","supsetneq","lnsim","gnsim","precnsim","succnsim","ntriangleleft","ntriangleright","ntrianglelefteq","ntrianglerighteq","nmid","nparallel","nvdash","nVdash","nvDash","nVDash","nexists"]}],r=a[2].options.box.group[2].items;r.push({title:e[0].title,content:t(e[0].values,"kityformula/assets/images/toolbar/char.png")})}(),function(){var e=["aleph","beth","daleth","gimel","complement","ell","eth","hbar","hslash","mho","partial","wp","circledS","Bbbk","Finv","Game","Im","Re"],r=a[2].options.box.group[3].items;r.push({title:"字母类符号",content:t(e,"kityformula/assets/images/toolbar/char.png")})}(),function(){var e=["gets","to","uparrow","downarrow","leftrightarrow","updownarrow","Leftarrow","Rightarrow","Uparrow","Downarrow","Leftrightarrow","Updownarrow","longleftarrow","longrightarrow","longleftrightarrow","Longleftarrow","Longrightarrow","Longleftrightarrow","nearrow","nwarrow","searrow","swarrow","nleftarrow","nrightarrow","nLeftarrow","nRightarrow","nLeftrightarrow","leftharpoonup","leftharpoondown","rightharpoonup","rightharpoondown","upharpoonleft","upharpoonright","downharpoonleft","downharpoonright","leftrightharpoons","rightleftharpoons","leftleftarrows","rightrightarrows","upuparrows","downdownarrows","leftrightarrows","rightleftarrows","looparrowleft","looparrowright","leftarrowtail","rightarrowtail","Lsh","Rsh","Lleftarrow","Rrightarrow","curvearrowleft","curvearrowright","circlearrowleft","circlearrowright","multimap","leftrightsquigarrow","twoheadleftarrow","twoheadrightarrow","rightsquigarrow"],r=a[2].options.box.group[4].items;r.push({title:"箭头",content:t(e,"kityformula/assets/images/toolbar/char.png")})}(),function(){var e=[{title:"手写体",values:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"]},{title:"花体",values:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"]},{title:"双线",values:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"]},{title:"罗马",values:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"]}],r=a[2].options.box.group[5].items;s.Utils.each(e[0].values,function(t,r){e[0].values[r]="mathcal{"+t+"}"}),s.Utils.each(e[1].values,function(t,r){e[1].values[r]="mathfrak{"+t+"}"}),s.Utils.each(e[2].values,function(t,r){e[2].values[r]="mathbb{"+t+"}"}),s.Utils.each(e[3].values,function(t,r){e[3].values[r]="mathrm{"+t+"}"}),r.push({title:e[0].title,content:t(e[0].values,"kityformula/assets/images/toolbar/char.png")}),r.push({title:e[1].title,content:t(e[1].values,"kityformula/assets/images/toolbar/char.png")}),r.push({title:e[2].title,content:t(e[2].values,"kityformula/assets/images/toolbar/char.png")}),r.push({title:e[3].title,content:t(e[3].values,"kityformula/assets/images/toolbar/char.png")})}(),a}},e[36]={value:function(){function t(t,e,o){switch(t){case l.DRAPDOWN_BOX:return r(e,o);case l.DELIMITER:return i(e);case l.AREA:return n(e,o)}}function r(t,e){return new s.DrapdownBox(t,e)}function i(t){return new s.Delimiter(t)}function n(t,e){return new s.Area(t,e)}var o=e.r(20),s=e.r(48),a=e.r(47),l=e.r(41),h=o.createClass("Tollbar",{constructor:function(t,e,r){this.kfEditor=e,this.uiComponent=t,this.elementList=r,this.elements=[],this.initToolbarElements(),this.initServices(),this.initEvent()},initServices:function(){this.kfEditor.registerService("ui.toolbar.disable",this,{disableToolbar:this.disableToolbar}),this.kfEditor.registerService("ui.toolbar.enable",this,{enableToolbar:this.enableToolbar}),this.kfEditor.registerService("ui.toolbar.close",this,{closeToolbar:this.closeToolbar})},initEvent:function(){var t=this;a.on(this.uiComponent.toolbarContainer,"mousedown",function(t){t.preventDefault()}),a.on(this.uiComponent.toolbarContainer,"mousewheel",function(t){t.preventDefault()}),a.on(this.kfEditor.getContainer(),"mousedown",function(){t.notify("closeAll")}),a.subscribe("data.select",function(e){t.insertSource(e)})},insertSource:function(t){charMap&&(t=t.split("\\")[0]?t.split("\\")[0]:t.split("\\")[1],charMap[t]&&(t=charMap[t])),this.kfEditor.requestService("control.insert.string",t)},disableToolbar:function(){o.Utils.each(this.elements,function(t){t.disable&&t.disable()})},enableToolbar:function(){o.Utils.each(this.elements,function(t){t.enable&&t.enable()})},getContainer:function(){return this.kfEditor.requestService("ui.get.canvas.container")},closeToolbar:function(){this.closeElement()},notify:function(t){switch(t){case"closeAll":case"closeOther":return void this.closeElement(arguments[1])}},closeElement:function(t){o.Utils.each(this.elements,function(e){e!=t&&e.hide&&e.hide()})},initToolbarElements:function(){var e=this.elements,r=this.uiComponent.toolbarContainer.ownerDocument,i=this;o.Utils.each(this.elementList,function(n){var o=t(n.type,r,n.options);e.push(o),i.appendElement(o)})},appendElement:function(t){t.setToolbar(this),t.attachTo(this.uiComponent.toolbarContainer)}});return h}},e[37]={value:function(){var t=e.r(20),r="kf-editor-ui-",i=66,n=e.r(47),o=e.r(38),s=t.createClass("Area",{constructor:function(t,e){this.options=e,this.doc=t,this.toolbar=null,this.disabled=!0,this.panelIndex=0,this.maxPanelIndex=0,this.currentItemCount=0,this.lineMaxCount=9,this.element=this.createArea(),this.container=this.createContainer(),this.panel=this.createPanel(),this.buttonContainer=this.createButtonContainer(),this.button=this.createButton(),this.mountPoint=this.createMountPoint(),this.moveDownButton=this.createMoveDownButton(),this.moveUpButton=this.createMoveUpButton(),this.boxObject=this.createBox(),this.mergeElement(),this.mount(),this.setListener(),this.initEvent()},initEvent:function(){var t=this;n.on(this.button,"mousedown",function(e){e.preventDefault(),e.stopPropagation(),1!==e.which||t.disabled||(t.showMount(),t.toolbar.notify("closeOther",t))}),n.on(this.moveDownButton,"mousedown",function(e){e.preventDefault(),e.stopPropagation(),1!==e.which||t.disabled||(t.nextPanel(),t.toolbar.notify("closeOther",t))}),n.on(this.moveUpButton,"mousedown",function(e){e.preventDefault(),e.stopPropagation(),1!==e.which||t.disabled||(t.prevPanel(),t.toolbar.notify("closeOther",t))}),n.delegate(this.container,".kf-editor-ui-area-item","mousedown",function(e){e.preventDefault(),1!==e.which||t.disabled||n.publish("data.select",this.getAttribute("data-value"))}),this.boxObject.initEvent()},disable:function(){this.disabled=!0,this.boxObject.disable(),n.getClassList(this.element).remove(r+"enabled")},enable:function(){this.disabled=!1,this.boxObject.enable(),n.getClassList(this.element).add(r+"enabled")},setListener:function(){var t=this;this.boxObject.setSelectHandler(function(e){n.publish("data.select",e),t.hide()}),this.boxObject.setChangeHandler(function(){t.updateContent()})},createArea:function(){var t=n.ele(this.doc,"div",{className:r+"area"});return"width"in this.options&&(t.style.width=this.options.width+"px"),t},checkMaxPanelIndex:function(){this.maxPanelIndex=Math.ceil(this.currentItemCount/this.lineMaxCount/2)},updateContent:function(){var e=this.boxObject.getOverlapContent(),i=0,n=null,o=0,s=0,a=this.lineMaxCount,l=[];this.panel.innerHTML="",t.Utils.each(e,function(e){var h=e.content;t.Utils.each(h,function(t){o=Math.floor(i/a),s=i%a,i++,n="top: "+(33*o+5)+"px; left: "+(32*s+5)+"px;",l.push('<div class="'+r+'area-item" data-value="'+t.key+'" style="'+n+'"><div class="'+r+'area-item-inner"><div class="'+r+'area-item-img" style="background: url('+t.img+") no-repeat "+-t.pos.x+"px "+-t.pos.y+'px;"></div></div></div>')})}),this.currentItemCount=i,this.panelIndex=0,this.panel.style.top=0,this.panel.innerHTML=l.join(""),this.checkMaxPanelIndex(),this.updatePanelButtonState()},mount:function(){this.boxObject.mountTo(this.mountPoint)},showMount:function(){this.mountPoint.style.display="block",this.boxObject.updateSize()},hideMount:function(){this.mountPoint.style.display="none"},hide:function(){this.hideMount(),this.boxObject.hide()},createButton:function(){return n.ele(this.doc,"div",{className:r+"area-button"})},createMoveDownButton:function(){return n.ele(this.doc,"div",{className:r+"movedown-button",content:""})},createMoveUpButton:function(){return n.ele(this.doc,"div",{className:r+"moveup-button",content:""})},createMountPoint:function(){return n.ele(this.doc,"div",{className:r+"area-mount"})},createBox:function(){return new o(this.doc,this.options.box)},createContainer:function(){return n.ele(this.doc,"div",{className:r+"area-container"})},createPanel:function(){return n.ele(this.doc,"div",{className:r+"area-panel"})},createButtonContainer:function(){return n.ele(this.doc,"div",{className:r+"area-button-container"})},mergeElement:function(){this.buttonContainer.appendChild(this.moveUpButton),this.buttonContainer.appendChild(this.moveDownButton),this.buttonContainer.appendChild(this.button),this.container.appendChild(this.panel),this.element.appendChild(this.container),this.element.appendChild(this.buttonContainer),this.element.appendChild(this.mountPoint)},disablePanelUp:function(){this.disabledUp=!0,n.getClassList(this.moveUpButton).add("kf-editor-ui-disabled")},enablePanelUp:function(){this.disabledUp=!1,n.getClassList(this.moveUpButton).remove("kf-editor-ui-disabled")},disablePanelDown:function(){this.disabledDown=!0,n.getClassList(this.moveDownButton).add("kf-editor-ui-disabled")},enablePanelDown:function(){this.disabledDown=!1,n.getClassList(this.moveDownButton).remove("kf-editor-ui-disabled")},updatePanelButtonState:function(){0===this.panelIndex?this.disablePanelUp():this.enablePanelUp(),this.panelIndex+1>=this.maxPanelIndex?this.disablePanelDown():this.enablePanelDown()},nextPanel:function(){this.disabledDown||this.panelIndex+1>=this.maxPanelIndex||(this.panelIndex++,this.panel.style.top=-this.panelIndex*i+"px",this.updatePanelButtonState())},prevPanel:function(){this.disabledUp||0!==this.panelIndex&&(this.panelIndex--,this.panel.style.top=-this.panelIndex*i+"px",this.updatePanelButtonState())},setToolbar:function(t){this.toolbar=t,this.boxObject.setToolbar(t)},attachTo:function(t){t.appendChild(this.element),this.updateContent(),this.updatePanelButtonState()}});return s}},e[38]={value:function(){function t(t,e,r){var i=[];return a.Utils.each(e,function(e){i.push(new m(r,t,e))}),i}function r(t){return h.ele(t,"div",{className:l+"overlap-container"})}function i(t,e){return new d(t,{className:"overlap-button",label:"",fixOffset:e.fixOffset})}function n(t,e){return new p(t,e)}function o(t){return t.getBoundingClientRect()}function s(t){var e="background: url( "+t.img+" ) no-repeat ";return e+=-t.pos.x+"px ",e+=-t.pos.y+"px;",e+=" width: "+t.size.width+"px;",e+=" height: "+t.size.height+"px;"}var a=e.r(20),l="kf-editor-ui-",h=e.r(47),c=e.r(40),u=e.r(42),d=e.r(39),p=e.r(45),f=20,g=a.createClass("Box",{constructor:function(t,e){this.options=e,this.toolbar=null,this.options.type=this.options.type||c.DETACHED,this.doc=t,this.itemPanels=null,this.overlapButtonObject=null,this.overlapIndex=-1,this.element=this.createBox(),this.groupContainer=this.createGroupContainer(),this.itemGroups=this.createItemGroup(),this.mergeElement()},createBox:function(){var t=h.ele(this.doc,"div",{className:l+"box"});return"width"in this.options&&(t.style.width=this.options.width+"px"),t},setToolbar:function(t){this.toolbar=t,this.overlapButtonObject&&this.overlapButtonObject.setToolbar(t)},updateSize:function(){var t=h.getRectBox(this.toolbar.getContainer()),e=30,r=h.getRectBox(this.element);if(this.options.type===c.DETACHED){if(r.bottom<=t.bottom)return void(this.element.scrollTop=0);this.element.style.height=r.height-(r.bottom-t.bottom+e)+"px"}else{var i=this.getCurrentItemPanel(),n=null;if(i.scrollTop=0,r.bottom<=t.bottom)return;n=o(i),i.style.height=t.bottom-n.top-e+"px"}},initEvent:function(){var t="."+l+"box-item",e=this;h.delegate(this.groupContainer,t,"mousedown",function(t){t.preventDefault(),1===t.which&&e.onselectHandler&&e.onselectHandler(this.getAttribute("data-value"))}),h.on(this.element,"mousedown",function(t){t.stopPropagation(),t.preventDefault()}),h.on(this.element,"mousewheel",function(t){t.preventDefault(),t.stopPropagation(),e.scroll(t.originalEvent.wheelDelta)})},getNode:function(){return this.element},setSelectHandler:function(t){this.onselectHandler=t},scroll:function(t){0>t?this.scrollDown():(this.scrollUp(),this.element.scrollTop-=20)},scrollDown:function(){this.options.type===c.DETACHED?this.element.scrollTop+=f:this.getCurrentItemPanel().scrollTop+=f},scrollUp:function(){this.options.type===c.DETACHED?this.element.scrollTop-=f:this.getCurrentItemPanel().scrollTop-=f},setChangeHandler:function(t){this.onchangeHandler=t},onchangeHandler:function(){},createGroupContainer:function(){return h.ele(this.doc,"div",{className:l+"box-container"})},getPositionInfo:function(){return h.getRectBox(this.element)},createItemGroup:function(){var t=this.createGroup();switch(this.options.type){case c.DETACHED:return t.items[0];case c.OVERLAP:return this.createOverlapGroup(t)}return null},enable:function(){this.overlapButtonObject&&this.overlapButtonObject.enable()},disable:function(){this.overlapButtonObject&&this.overlapButtonObject.disable()},hide:function(){this.overlapButtonObject&&this.overlapButtonObject.hideMount()},getOverlapContent:function(){return this.options.type!==c.OVERLAP?null:this.options.group[this.overlapIndex].items},createOverlapGroup:function(t){var e=t.title,o=this,s=r(this.doc),c=i(this.doc,{fixOffset:this.options.fixOffset}),u=n(this.doc,{width:150,items:e}),d=h.ele(this.doc,"div",{className:l+"wrap-group"});return this.overlapButtonObject=c,c.mount(u),c.initEvent(),u.initEvent(),a.Utils.each(t.items,function(e,r){var i=d.cloneNode(!1);a.Utils.each(e,function(t){i.appendChild(t)}),t.items[r]=i}),this.itemPanels=t.items,u.setSelectHandler(function(r,i){o.overlapIndex=r,c.setLabel(e[r]),c.hideMount(),t.items[i].style.display="none",t.items[r].style.display="block",r!==i&&o.updateSize(),o.onchangeHandler(r)}),s.appendChild(c.getNode()),a.Utils.each(t.items,function(t,e){e>0&&(t.style.display="none"),s.appendChild(t)}),u.select(0),[s]},getCurrentItemPanel:function(){return this.itemPanels[this.overlapIndex]},getGroupList:function(){var t=[];return a.Utils.each(this.options.group,function(e){t.push(e.title)}),{width:150,items:t}},createGroup:function(){var e=this.doc,r=[],i={title:[],items:[]},n=null,o=null,s=c.DETACHED===this.options.type?u.BIG:u.SMALL,d=null;return n=h.ele(this.doc,"div",{className:l+"box-group"}),d=n.cloneNode(!1),d.className=l+"box-group-item-container",a.Utils.each(this.options.group,function(c){i.title.push(c.title||""),r=[],a.Utils.each(c.items,function(i){n=n.cloneNode(!1),d=d.cloneNode(!1),o=h.ele(e,"div",{className:l+"box-group-title",content:i.title}),n.appendChild(o),n.appendChild(d),a.Utils.each(t(e,i.content,s),function(t){t.appendTo(d)}),r.push(n)}),i.items.push(r)}),i},mergeElement:function(){var t=this.groupContainer;this.element.appendChild(t),a.Utils.each(this.itemGroups,function(e){t.appendChild(e)})},mountTo:function(t){t.appendChild(this.element)},appendTo:function(t){t.appendChild(this.element)}}),m=a.createClass("BoxItem",{constructor:function(t,e,r){this.type=t,this.doc=e,this.options=r,this.element=this.createItem(),this.labelNode=this.createLabel(),this.contentNode=this.createContent(),this.mergeElement()},getNode:function(){return this.element},createItem:function(){var t=h.ele(this.doc,"div",{className:l+"box-item"});return t},createLabel:function(){var t=null;return"label"in this.options?t=h.ele(this.doc,"div",{className:l+"box-item-label",content:this.options.label}):void 0},getContent:function(){},createContent:function(){switch(this.type){case u.BIG:return this.createBigContent();case u.SMALL:return this.createSmallContent()}},createBigContent:function(){var t=this.doc,e=h.ele(t,"div",{className:l+"box-item-content"}),r=l+"box-item-val",i=this.options.item,n=null,o=s(i);return n=h.ele(t,"div",{className:r}),n.innerHTML='<div class="'+l+'item-image" style="'+o+'"></div>',this.element.setAttribute("data-value",i.val),e.appendChild(n),e},createSmallContent:function(){var t=this.doc,e=h.ele(t,"div",{className:l+"box-item-content"}),r=l+"box-item-val",i=this.options,n=null;return n=h.ele(t,"div",{className:r}),n.style.background="url( "+i.img+" )",n.style.backgroundPosition=-i.pos.x+"px "+-i.pos.y+"px",this.element.setAttribute("data-value",i.key),e.appendChild(n),e},mergeElement:function(){this.labelNode&&this.element.appendChild(this.labelNode),this.element.appendChild(this.contentNode)},appendTo:function(t){t.appendChild(this.element)}});return g}},e[39]={value:function(){function t(t){var e="url( "+t.src+" ) no-repeat ";return e+=-t.x+"px ",e+=-t.y+"px"}var r=e.r(20),i="kf-editor-ui-",n=7,o={iconSize:{w:32,h:32}},s=e.r(47),a=r.createClass("Button",{constructor:function(t,e){this.options=r.Utils.extend({},o,e),this.eventState=!1,this.toolbar=null,this.displayState=!1,this.fixOffset=e.fixOffset||!1,this.doc=t,this.element=this.createButton(),this.disabled=!0,this.mountElement=null,this.icon=this.createIcon(),this.label=this.createLabel(),this.sign=this.createSign(),this.mountPoint=this.createMountPoint(),this.mergeElement()},initEvent:function(){var t=this;this.eventState||(this.eventState=!0,s.on(this.element,"mousedown",function(e){e.preventDefault(),e.stopPropagation(),1===e.which&&(t.disabled||(t.toggleSelect(),t.toggleMountElement()))}))},setToolbar:function(t){this.toolbar=t},toggleMountElement:function(){this.displayState?this.hideMount():this.showMount()},setLabel:function(t){var e="";this.sign&&(e='<div class="'+i+'button-sign"></div>'),this.label.innerHTML=t+e},toggleSelect:function(){s.getClassList(this.element).toggle(i+"button-in")},unselect:function(){s.getClassList(this.element).remove(i+"button-in")},select:function(){s.getClassList(this.element).add(i+"button-in")},show:function(){this.select(),this.showMount()},hide:function(){this.unselect(),this.hideMount()},showMount:function(){if(this.displayState=!0,this.mountPoint.style.display="block",this.fixOffset){var t=this.element.getBoundingClientRect();this.mountElement.setOffset(t.left+n,t.bottom)}var e=this.toolbar.getContainer(),r=null,i=s.getRectBox(e),o=this.mountElement.getPositionInfo();o.right>i.right&&(r=s.getRectBox(this.element),this.mountPoint.style.left=r.right-o.right-1+"px"),this.mountElement.updateSize&&this.mountElement.updateSize()},hideMount:function(){this.displayState=!1,this.mountPoint.style.display="none"},getNode:function(){return this.element},mount:function(t){this.mountElement=t,t.mountTo(this.mountPoint)},createButton:function(){var t=s.ele(this.doc,"div",{className:i+"button"});return this.options.className&&(t.className+=" "+i+this.options.className),t},createIcon:function(){if(!this.options.icon)return null;var e=s.ele(this.doc,"div",{className:i+"button-icon"});return"string"==typeof this.options.icon?e.style.backgroundImage="url("+this.options.icon+") no-repeat":e.style.background=t(this.options.icon),this.options.iconSize.w&&(e.style.width=this.options.iconSize.w+"px"),this.options.iconSize.h&&(e.style.height=this.options.iconSize.h+"px"),e},createLabel:function(){var t=s.ele(this.doc,"div",{className:i+"button-label",content:this.options.label});return t},createSign:function(){return this.options.sign===!1?null:s.ele(this.doc,"div",{className:i+"button-sign"})},createMountPoint:function(){return s.ele(this.doc,"div",{className:i+"button-mount-point"})},disable:function(){this.disabled=!0,s.getClassList(this.element).remove(i+"enabled")},enable:function(){this.disabled=!1,s.getClassList(this.element).add(i+"enabled")},mergeElement:function(){this.icon&&this.element.appendChild(this.icon),this.element.appendChild(this.label),this.sign&&this.label.appendChild(this.sign),this.element.appendChild(this.mountPoint)}});return a}},e[40]={value:function(){return{DETACHED:1,OVERLAP:2}}},e[41]={value:function(){return{DRAPDOWN_BOX:1,AREA:2,DELIMITER:3}}},e[42]={value:function(){return{BIG:1,SMALL:2}}},e[43]={value:function(){var t=e.r(20),r="kf-editor-ui-",i=e.r(47),n=t.createClass("Delimiter",{constructor:function(t){this.doc=t,this.element=this.createDilimiter()},setToolbar:function(){},createDilimiter:function(){var t=i.ele(this.doc,"div",{className:r+"delimiter"});return t.appendChild(i.ele(this.doc,"div",{className:r+"delimiter-line"})),t},attachTo:function(t){t.appendChild(this.element)
}});return n}},e[44]={value:function(){var t=e.r(20),r=e.r(47),i=e.r(39),n=e.r(38),o=t.createClass("DrapdownBox",{constructor:function(t,e){this.options=e,this.toolbar=null,this.doc=t,this.buttonElement=this.createButton(),this.element=this.buttonElement.getNode(),this.boxElement=this.createBox(),this.buttonElement.mount(this.boxElement),this.initEvent()},initEvent:function(){var t=this;r.on(this.element,"mousedown",function(e){e.preventDefault(),e.stopPropagation(),t.toolbar.notify("closeOther",t)}),this.buttonElement.initEvent(),this.boxElement.initEvent(),this.boxElement.setSelectHandler(function(e){r.publish("data.select",e),t.buttonElement.hide()})},disable:function(){this.buttonElement.disable()},enable:function(){this.buttonElement.enable()},setToolbar:function(t){this.toolbar=t,this.buttonElement.setToolbar(t),this.boxElement.setToolbar(t)},createButton:function(){return new i(this.doc,this.options.button)},show:function(){this.buttonElement.show()},hide:function(){this.buttonElement.hide()},createBox:function(){return new n(this.doc,this.options.box)},attachTo:function(t){t.appendChild(this.element)}});return o}},e[45]={value:function(){var t=e.r(20),r="kf-editor-ui-",i=e.r(47),n=t.createClass("List",{constructor:function(t,e){this.options=e,this.doc=t,this.onselectHandler=null,this.currentSelect=-1,this.element=this.createBox(),this.itemGroups=this.createItems(),this.mergeElement()},onselectHandler:function(){},setSelectHandler:function(t){this.onselectHandler=t},createBox:function(){var t=i.ele(this.doc,"div",{className:r+"list"}),e=i.ele(this.doc,"div",{className:r+"list-bg"});return"width"in this.options&&(t.style.width=this.options.width+"px"),t.appendChild(e),t},select:function(t){var e=this.currentSelect;-1===e&&(e=t),this.unselect(e),this.currentSelect=t,i.getClassList(this.itemGroups.items[t]).add(r+"list-item-select"),this.onselectHandler(t,e)},unselect:function(t){i.getClassList(this.itemGroups.items[t]).remove(r+"list-item-select")},setOffset:function(t,e){this.element.style.left=t+"px",this.element.style.top=e+"px"},initEvent:function(){var t="."+r+"list-item",e=this;i.delegate(this.itemGroups.container,t,"mousedown",function(t){t.preventDefault(),1===t.which&&e.select(this.getAttribute("data-index"))}),i.on(this.element,"mousedown",function(t){t.stopPropagation(),t.preventDefault()})},getPositionInfo:function(){return i.getRectBox(this.element)},createItems:function(){var e=this.doc,n=null,o=null,s=null,a=[],l=null;return n=i.ele(this.doc,"div",{className:r+"list-item"}),l=n.cloneNode(!1),l.className=r+"list-item-container",t.Utils.each(this.options.items,function(t,h){o=n.cloneNode(!1),s=n.cloneNode(!1),s.className=r+"list-item-icon",o.appendChild(s),o.appendChild(i.ele(e,"text",t)),o.setAttribute("data-index",h),a.push(o),l.appendChild(o)}),{container:l,items:a}},mergeElement:function(){this.element.appendChild(this.itemGroups.container)},mountTo:function(t){t.appendChild(this.element)}});return n}},e[46]={value:function(){function t(t,e,r){var i=t.createElement(e),n='<div class="$1"></div><div class="$2"></div>';return i.className=v+r,"thumb"===r&&(r=v+r,i.innerHTML=n.replace("$1",r+"-left").replace("$2",r+"-right")),i}function r(t){return t.getBoundingClientRect()}function i(t){m.addEvent(t,"mousedown",function(t){t.preventDefault()})}function i(t){m.addEvent(t.container,"mousedown",function(t){t.preventDefault()})}function n(t){m.addEvent(t.widgets.track,"mousedown",function(e){a(this,t,e)})}function o(t){m.addEvent(t.widgets.leftButton,"mousedown",function(){h(t,-g.step)}),m.addEvent(t.widgets.rightButton,"mousedown",function(){h(t,g.step)})}function s(t){var e=!1,r=0,i=0,n=t.values.trackWidth;m.addEvent(t.widgets.thumb,"mousedown",function(n){n.preventDefault(),n.stopPropagation(),e=!0,r=n.clientX,i=t.thumbLocationX}),m.addEvent(t.container.ownerDocument,"mouseup",function(){e=!1,r=0,i=0}),m.addEvent(t.container.ownerDocument,"mousemove",function(o){if(e){var s=o.clientX-r,a=i+s,h=t.values.thumbWidth;0>a?a=0:a+h>n&&(a=n-h),l(t,a)}})}function a(t,e,i){var n=r(t),o=e.values,s=o.viewWidth/(o.contentWidth-o.viewWidth)*o.trackWidth,a=i.clientX-n.left;a>o.offset?o.offset+s>o.trackWidth?c(e,o.trackWidth):c(e,o.offset+s):o.offset-s<0?c(e,0):c(e,o.offset-s)}function l(t,e){var r=t.values,i=r.trackWidth-r.thumbWidth,n=Math.floor(e/i*r.trackWidth);t.updateOffset(n),t.thumbLocationX=e,t.widgets.thumb.style.left=e+"px"}function h(t,e){var r=t.leftOverflow+e;0>r?r=0:r>t.values.scrollWidth&&(r=t.values.scrollWidth),d(t,r)}function c(t,e){var r=t.values,i=e/r.trackWidth,n=r.trackWidth-r.thumbWidth,o=0;o=Math.floor(i*n),0>e&&(e=0,o=0),t.updateOffset(e),t.widgets.thumb.style.left=o+"px",t.thumbLocationX=o}function u(t,e){var r=t.values,i=0,n=0;i=e/(r.contentWidth-r.viewWidth),n=Math.floor(i*r.trackWidth),c(t,n)}function d(t,e){var r=t.values,i=e/(r.contentWidth-r.viewWidth);c(t,i*r.trackWidth)}var p=e.r(20),f=e.r(32).scrollbar,g=e.r(29).scrollbar,m=e.r(4),v="kf-editor-ui-";return p.createClass("Scrollbar",{constructor:function(t,e){this.uiComponent=t,this.kfEditor=e,this.widgets=null,this.container=this.uiComponent.scrollbarContainer,this.state=!1,this.values={offset:0,left:0,viewWidth:0,contentWidth:0,trackWidth:0,thumbWidth:0,scrollWidth:0},this.thumbLocationX=0,this.leftOverflow=0,this.rightOverflow=0,this.isExpand=!0,this.initWidget(),this.mountWidget(),this.initSize(),this.hide(),this.initServices(),this.initEvent(),this.updateHandler=function(){}},initWidget:function(){var e=this.container.ownerDocument;this.widgets={leftButton:t(e,"div","left-button"),rightButton:t(e,"div","right-button"),track:t(e,"div","track"),thumb:t(e,"div","thumb"),thumbBody:t(e,"div","thumb-body")}},initSize:function(){var t=r(this.widgets.leftButton).width,e=r(this.widgets.rightButton).width;this.values.viewWidth=r(this.container).width,this.values.trackWidth=this.values.viewWidth-t-e,this.widgets.track.style.width=this.values.trackWidth+"px"},initServices:function(){this.kfEditor.registerService("ui.show.scrollbar",this,{showScrollbar:this.show}),this.kfEditor.registerService("ui.hide.scrollbar",this,{hideScrollbar:this.hide}),this.kfEditor.registerService("ui.update.scrollbar",this,{updateScrollbar:this.update}),this.kfEditor.registerService("ui.set.scrollbar.update.handler",this,{setUpdateHandler:this.setUpdateHandler}),this.kfEditor.registerService("ui.relocation.scrollbar",this,{relocation:this.relocation})},initEvent:function(){i(this),n(this),s(this),o(this)},mountWidget:function(){var t=this.widgets,e=this.container;for(var r in t)t.hasOwnProperty(r)&&e.appendChild(t[r]);t.thumb.appendChild(t.thumbBody),t.track.appendChild(t.thumb)},show:function(){this.state=!0,this.container.style.display="block"},hide:function(){this.state=!1,this.container.style.display="none"},update:function(t){var e=this.values.trackWidth,r=0;return this.isExpand=t>this.values.contentWidth,this.values.contentWidth=t,this.values.scrollWidth=t-this.values.viewWidth,e>=t?void this.hide():(r=Math.max(Math.ceil(e*e/t),f.thumbMinSize),this.values.thumbWidth=r,this.widgets.thumb.style.width=r+"px",void(this.widgets.thumbBody.style.width=r-10+"px"))},setUpdateHandler:function(t){this.updateHandler=t},updateOffset:function(t){var e=this.values;e.offset=t,e.left=t/e.trackWidth,this.leftOverflow=e.left*(e.contentWidth-e.viewWidth),this.rightOverflow=e.contentWidth-e.viewWidth-this.leftOverflow,this.updateHandler(e.left,e.offset,e)},relocation:function(){var t=this.kfEditor.requestService("control.get.cursor.location"),e=g.padding,r=this.values.contentWidth,i=this.values.viewWidth,n=this.values.left*(r-i),o=0;t.x<n?(t.x<0&&(t.x=0),u(this,t.x)):t.x+e>n+i?(t.x+=e,t.x>r&&(t.x=r),o=t.x-i,u(this,o)):this.isExpand?d(this,this.leftOverflow):d(this,r-i-this.rightOverflow)}})}},e[47]={value:function(){function t(t){this.node=t,this.classes=t.className.replace(/^\s+|\s+$/g,"").split(/\s+/)}var r=e.r(14),i=e.r(20),n={},o={ele:function(t,e,r){var i=null;return"text"===e?t.createTextNode(r):(i=t.createElement(e),r.className&&(i.className=r.className),r.content&&(i.innerHTML=r.content),i)},getRectBox:function(t){return t.getBoundingClientRect()},on:function(t,e,i){return r(t).on(e,i),this},delegate:function(t,e,i,n){return r(t).delegate(e,i,n),this},publish:function(t,e){var r=n[t];r&&(e=[].slice.call(arguments,1),i.Utils.each(r,function(t){t.apply(null,e)}))},subscribe:function(t,e){n[t]||(n[t]=[]),n[t].push(e)},getClassList:function(e){return e.classList||new t(e)}};return t.prototype={constructor:t,contains:function(t){return-1!==this.classes.indexOf(t)},add:function(t){return-1==this.classes.indexOf(t)&&this.classes.push(t),this._update(),this},remove:function(t){var e=this.classes.indexOf(t);return-1!==e&&(this.classes.splice(e,1),this._update()),this},toggle:function(t){var e=this.contains(t)?"remove":"add";return this[e](t)},_update:function(){this.node.className=this.classes.join(" ")}},o}},e[48]={value:function(){return{DrapdownBox:e.r(44),Delimiter:e.r(43),Area:e.r(37)}}},e[49]={value:function(){function t(t){return a.ele(t,"div",{className:"kf-editor-toolbar"})}function r(t){return a.ele(t,"div",{className:"kf-editor-inner-toolbar"})}function i(t){var e=t.createElement("div");return e.className="kf-editor-edit-area",e.style.width="80%",e.style.height="800px",e}function n(t){var e=t.createElement("div");return e.className="kf-editor-canvas-container",e}function o(t){var e=t.createElement("div");return e.className="kf-editor-edit-scrollbar",e}var s=e.r(20),a=e.r(47),l=e.r(4),h=e.r(32).VIEW_STATE,c=e.r(46),u=e.r(36),d=(e.r(31),e.r(35)),p=s.createClass("UIComponent",{constructor:function(e,s){var a=null;this.options=s,this.container=e.getContainer(),a=this.container.ownerDocument,this.components={},this.canvasRect=null,this.viewState=h.NO_OVERFLOW,this.kfEditor=e,this.toolbarWrap=t(a),this.toolbarContainer=r(a),this.editArea=i(a),this.canvasContainer=n(a),this.scrollbarContainer=o(a),this.toolbarWrap.appendChild(this.toolbarContainer),this.container.appendChild(this.toolbarWrap),this.editArea.appendChild(this.canvasContainer),this.container.appendChild(this.editArea),this.container.appendChild(this.scrollbarContainer),this.initComponents(),this.initServices(),this.initEvent(),this.updateContainerSize(this.container,this.toolbarWrap,this.editArea,this.canvasContainer),this.initScrollEvent()},initComponents:function(){this.components.toolbar=new u(this,this.kfEditor,d),this.components.scrollbar=new c(this,this.kfEditor)},updateContainerSize:function(t,e,r){var i=t.getBoundingClientRect(),n=e.getBoundingClientRect();r.style.width=i.width+"px",r.style.height=i.bottom-n.bottom+"px"},initServices:function(){this.kfEditor.registerService("ui.get.canvas.container",this,{getCanvasContainer:this.getCanvasContainer}),this.kfEditor.registerService("ui.update.canvas.view",this,{updateCanvasView:this.updateCanvasView}),this.kfEditor.registerService("ui.canvas.container.event",this,{on:this.addEvent,off:this.removeEvent,trigger:this.trigger,fire:this.trigger})},initEvent:function(){},initScrollEvent:function(){var t=this;this.kfEditor.requestService("ui.set.scrollbar.update.handler",function(e,r,i){r=Math.floor(e*(i.contentWidth-i.viewWidth)),t.kfEditor.requestService("render.set.canvas.offset",r)})},getCanvasContainer:function(){return this.canvasContainer},addEvent:function(t,e){l.addEvent(this.canvasContainer,t,e)},removeEvent:function(){},trigger:function(t){l.trigger(this.canvasContainer,t)},updateCanvasView:function(){var t=this.kfEditor.requestService("render.get.canvas"),e=t.getContentContainer(),r=null;null===this.canvasRect&&(this.canvasRect=this.canvasContainer.getBoundingClientRect()),r=e.getRenderBox("paper"),r.width>this.canvasRect.width?(this.viewState===h.NO_OVERFLOW&&(this.toggleViewState(),this.kfEditor.requestService("ui.show.scrollbar"),this.kfEditor.requestService("render.disable.relocation")),this.kfEditor.requestService("render.relocation"),this.kfEditor.requestService("ui.update.scrollbar",r.width),this.kfEditor.requestService("ui.relocation.scrollbar")):(this.viewState===h.OVERFLOW&&(this.toggleViewState(),this.kfEditor.requestService("ui.hide.scrollbar"),this.kfEditor.requestService("render.enable.relocation")),this.kfEditor.requestService("render.relocation"))},toggleViewState:function(){this.viewState=this.viewState===h.NO_OVERFLOW?h.OVERFLOW:h.NO_OVERFLOW}});return p}},e[50]={value:function(){var t=e.r(12),r=e.r(13);t.registerComponents("ui",e.r(49)),t.registerComponents("parser",e.r(21)),t.registerComponents("render",e.r(25)),t.registerComponents("position",e.r(23)),t.registerComponents("syntax",e.r(28)),t.registerComponents("control",e.r(5)),t.registerComponents("print",e.r(24)),kf.EditorFactory=r}};var r={"kf.start":50};!function(){try{t("kf.start")}catch(e){}}(this)}();